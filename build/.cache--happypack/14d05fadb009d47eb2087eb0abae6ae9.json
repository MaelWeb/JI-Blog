{"remainingRequest":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js?{\"presets\":[\"react-hmre\"]}!/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Photoes/index.js","dependencies":[{"path":"/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Photoes/index.js","mtime":1515732465145},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _index = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/redbox-react/lib/index.js');\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _index3 = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/react-transform-catch-errors/lib/index.js');\n\nvar _index4 = _interopRequireDefault(_index3);\n\nvar _react2 = require('react');\n\nvar _react3 = _interopRequireDefault(_react2);\n\nvar _index5 = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/react-transform-hmr/lib/index.js');\n\nvar _index6 = _interopRequireDefault(_index5);\n\nvar _class, _temp, _initialiseProps;\n\nvar _reactDom = require('react-dom');\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _reactPhotoGallery = require('react-photo-gallery');\n\nvar _reactPhotoGallery2 = _interopRequireDefault(_reactPhotoGallery);\n\nvar _reactMeasure = require('react-measure');\n\nvar _reactMeasure2 = _interopRequireDefault(_reactMeasure);\n\nvar _ImageGallery = require('../../../components/ImageGallery');\n\nvar _ImageGallery2 = _interopRequireDefault(_ImageGallery);\n\nvar _imageItem = require('./imageItem.js');\n\nvar _imageItem2 = _interopRequireDefault(_imageItem);\n\nvar _Icon = require('../../../components/Icon');\n\nvar _Icon2 = _interopRequireDefault(_Icon);\n\nvar _config = require('../../../config/');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _components = {\n    Photo: {\n        displayName: 'Photo'\n    }\n};\n\nvar _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformHmrLibIndexJs2 = (0, _index6.default)({\n    filename: '/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Photoes/index.js',\n    components: _components,\n    locals: [module],\n    imports: [_react3.default]\n});\n\nvar _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformCatchErrorsLibIndexJs2 = (0, _index4.default)({\n    filename: '/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Photoes/index.js',\n    components: _components,\n    locals: [],\n    imports: [_react3.default, _index2.default]\n});\n\nfunction _wrapComponent(id) {\n    return function (Component) {\n        return _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformHmrLibIndexJs2(_UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformCatchErrorsLibIndexJs2(Component, id), id);\n    };\n}\n\nvar Photo = _wrapComponent('Photo')((_temp = _class = function (_Component) {\n    (0, _inherits3.default)(Photo, _Component);\n\n    function Photo(props) {\n        (0, _classCallCheck3.default)(this, Photo);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (Photo.__proto__ || (0, _getPrototypeOf2.default)(Photo)).call(this, props));\n\n        _initialiseProps.call(_this);\n\n        var photoes = props.photoes,\n            page = props.page,\n            allPage = props.allPage;\n\n        var photoSrcs = _this.addSrc(photoes);\n        _this.state = {\n            photoes: photoSrcs,\n            allPage: allPage,\n            page: page,\n            showPhotoView: false,\n            currentPhotoIndex: 0,\n            isShowImageGallery: false,\n            imageGalleryIndex: 0,\n            isLoading: false\n        };\n        return _this;\n    }\n\n    (0, _createClass3.default)(Photo, [{\n        key: 'componentWillMount',\n        value: function componentWillMount() {\n            var photoes = this.state.photoes;\n\n            if (!photoes.length) this.getPhotos(1);\n        }\n    }, {\n        key: 'componentDidMount',\n        value: function componentDidMount() {\n            this.photoLayoutDom = _reactDom2.default.findDOMNode(this);\n            this.headerDom = _reactDom2.default.findDOMNode(this.refs.photoHeader);\n            this.blogNavDom = document.getElementById('IdNav');\n\n            this.blogNavDom.classList.add('blog-photo-header');\n\n            window.addEventListener(\"scroll\", this.onscroll, false);\n        }\n    }, {\n        key: 'getPhotos',\n        value: function getPhotos(page) {\n            var _this2 = this;\n\n            if (this.state.isLoading) return;\n            this.setState({\n                isLoading: true\n            });\n            _axios2.default.get('/api/get/photoes', { params: { page: page } }).then(function (res) {\n                var photoSrcs = _this2.addSrc(res.data.photoes);\n                _this2.setState(function (preState) {\n                    var photoes = preState.photoes.concat(photoSrcs);\n                    return {\n                        page: page,\n                        photoes: photoes,\n                        allPage: res.data.allPage,\n                        isLoading: false\n                    };\n                });\n            });\n        }\n    }, {\n        key: 'componentWillUnmount',\n        value: function componentWillUnmount() {\n            window.removeEventListener(\"scroll\", this.onscroll);\n            this.blogNavDom.classList.remove('blog-photoes-header');\n        }\n    }, {\n        key: 'addSrc',\n        value: function addSrc(allphoto) {\n            var photoes = [],\n                banner = [];\n            if (allphoto && allphoto.length) {\n                allphoto.map(function (photo) {\n                    var newPho = {\n                        src: '' + _config.IMG_URL + photo.key + _config.IMG_QUERY,\n                        original: '' + _config.IMG_URL + photo.key + _config.IMG_QUERY,\n                        thumbnail: '' + _config.IMG_URL + photo.key + _config.IMG_QUERY,\n                        width: photo.width,\n                        height: photo.height,\n                        desc: photo.desc\n                    };\n\n                    photoes.push(newPho);\n                });\n            }\n\n            return photoes;\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _this3 = this;\n\n            var _state = this.state,\n                photoes = _state.photoes,\n                width = _state.width,\n                showPhotoView = _state.showPhotoView,\n                currentPhotoIndex = _state.currentPhotoIndex,\n                isShowImageGallery = _state.isShowImageGallery,\n                imageGalleryIndex = _state.imageGalleryIndex,\n                isLoading = _state.isLoading;\n\n            return _react3.default.createElement(\n                'div',\n                { className: 'blog-photo-layout' },\n                _react3.default.createElement(\n                    'section',\n                    { className: 'photo-banner', ref: 'photoHeader', style: { backgroundImage: 'url(' + (photoes[0] && photoes[0].src || '//cdn.liayal.com/14506926.jpg') + ')' } },\n                    _react3.default.createElement('img', { src: photoes[0] && photoes[0].src || '//cdn.liayal.com/14506926.jpg', alt: '' }),\n                    _react3.default.createElement(\n                        'div',\n                        { className: 'photo-banner-info' },\n                        _react3.default.createElement(\n                            'p',\n                            { className: 'small' },\n                            _react3.default.createElement(\n                                'span',\n                                null,\n                                '\\u56FE\\u8BB0'\n                            )\n                        ),\n                        _react3.default.createElement(\n                            'h2',\n                            null,\n                            photoes[0] && photoes[0].desc ? photoes[0].desc : '一起老去'\n                        )\n                    )\n                ),\n                _react3.default.createElement(\n                    'section',\n                    { className: 'middle-text tc' },\n                    _react3.default.createElement(\n                        'h2',\n                        null,\n                        '\\u6211\\u4EE5\\u4E00\\u79CD\\u7B28\\u62D9\\u7684\\u65B9\\u5F0F\\u62CD\\u7167'\n                    ),\n                    _react3.default.createElement(\n                        'p',\n                        null,\n                        '\\u6444\\u5F71\\u662F\\u4E00\\u79CD\\u795E\\u5947\\u7684\\u8BB0\\u5F55\\uFF1A\\u7167\\u7247\\u8BB0\\u5F55\\u4E86\\u65F6\\u95F4\\u3001\\u98CE\\u666F\\u3001\\u4EBA\\u7269\\uFF1B\\u53EF\\u56DE\\u653E\\u7167\\u7247\\u65F6\\u624D\\u53D1\\u73B0\\uFF0C\\u539F\\u6765\\u5B83\\u8FD8\\u8BB0\\u5F55\\u4E86\\u6309\\u4E0B\\u5FEB\\u95E8\\u65F6\\u7684\\u611F\\u89E6\\u3001\\u601D\\u7EEA\\u3001\\u5FC3\\u4E8B\\u2026\\u2026\\u4E5F\\u8BB8\\u8FD9\\u5C31\\u662F\\u4E3A\\u4EC0\\u4E48\\u660E\\u660E\\u770B\\u5230\\u7684\\u662F\\u4E00\\u5F20\\u98CE\\u666F\\uFF0C\\u5374\\u4F1A\\u8BA9\\u4F60\\u60F3\\u8D77\\u8C01'\n                    )\n                ),\n                _react3.default.createElement(\n                    _reactMeasure2.default,\n                    { bounds: true, onResize: function onResize(contentRect) {\n                            return _this3.setState({ width: contentRect.bounds.width });\n                        } },\n                    function (_ref) {\n                        var measureRef = _ref.measureRef;\n\n                        var columns = 2;\n                        if (width >= 480) {\n                            columns = 3;\n                        }\n                        if (width >= 1024) {\n                            columns = 4;\n                        }\n                        if (width >= 1824) {\n                            columns = 5;\n                        }\n                        return _react3.default.createElement(\n                            'div',\n                            { ref: measureRef, className: 'photo-list' },\n                            _react3.default.createElement(_reactPhotoGallery2.default, { photos: photoes.slice(1), margin: 4, columns: columns, ImageComponent: _imageItem2.default, onClick: _this3.selectPhoto })\n                        );\n                    }\n                ),\n                isLoading ? _react3.default.createElement(\n                    'p',\n                    { className: 'loading' },\n                    '\\u52A0\\u8F7D\\u4E2D...'\n                ) : null,\n                _react3.default.createElement(_ImageGallery2.default, { images: photoes.slice(1), isShow: isShowImageGallery, startIndex: imageGalleryIndex })\n            );\n        }\n    }]);\n    return Photo;\n}(_react2.Component), _class.defaultProps = {\n    photoes: [],\n    page: 1,\n    allPage: 0\n}, _initialiseProps = function _initialiseProps() {\n    var _this4 = this;\n\n    this.onscroll = function (e) {\n        e = e || window.event;\n        var _scrollTop = window.pageYOffset || document.documentElement && document.documentElement.scrollTop || document.body.scrollTop || 0;\n\n        if (_scrollTop >= _this4.headerDom.offsetHeight - _this4.blogNavDom.offsetHeight) {\n            _this4.blogNavDom.classList.remove('blog-photoes-header');\n        } else {\n            _this4.blogNavDom.classList.add('blog-photoes-header');\n        }\n\n        var _state2 = _this4.state,\n            page = _state2.page,\n            allPage = _state2.allPage;\n\n        if (_scrollTop + document.documentElement.clientHeight > _this4.photoLayoutDom.offsetHeight - 150) {\n            page < allPage && _this4.getPhotos(page + 1);\n        }\n    };\n\n    this.selectPhoto = function (e, data) {\n        _this4.setState({\n            isShowImageGallery: true,\n            imageGalleryIndex: data.index\n        });\n    };\n}, _temp));\n\nexports.default = Photo;",{"version":3,"sources":["web/page/blog/Photoes/index.js"],"names":["props","photoes","page","allPage","photoSrcs","addSrc","state","showPhotoView","currentPhotoIndex","isShowImageGallery","imageGalleryIndex","isLoading","length","getPhotos","photoLayoutDom","findDOMNode","headerDom","refs","photoHeader","blogNavDom","document","getElementById","classList","add","window","addEventListener","onscroll","setState","get","params","then","res","data","preState","concat","removeEventListener","remove","allphoto","banner","map","newPho","src","photo","key","original","thumbnail","width","height","desc","push","backgroundImage","contentRect","bounds","measureRef","columns","slice","selectPhoto","defaultProps","e","event","_scrollTop","pageYOffset","documentElement","scrollTop","body","offsetHeight","clientHeight","index"],"mappings":"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","file":"index.js","sourceRoot":"/Users/mael.liang/Workspace/node-koa-test","sourcesContent":["import React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport Axios from 'axios';\nimport ClassNames from 'classnames';\nimport Gallery from 'react-photo-gallery';\nimport Measure from 'react-measure';\nimport ImageGallery from '../../../components/ImageGallery';\nimport ImageItem from './imageItem.js';\nimport Icon from '../../../components/Icon';\nimport {IMG_URL, IMG_QUERY} from '../../../config/';\n\n\nexport default class Photo extends Component {\n    constructor(props) {\n        super(props)\n        const { photoes, page, allPage } = props;\n        let photoSrcs = this.addSrc(photoes);\n        this.state = {\n           photoes: photoSrcs,\n           allPage,\n           page,\n           showPhotoView: false,\n           currentPhotoIndex: 0,\n           isShowImageGallery: false,\n           imageGalleryIndex: 0,\n           isLoading: false\n        };\n    }\n\n    static defaultProps = {\n        photoes: [],\n        page: 1,\n        allPage: 0\n    };\n\n    componentWillMount() {\n        const { photoes } = this.state;\n        if (!photoes.length)\n            this.getPhotos(1);\n    }\n\n    componentDidMount() {\n        this.photoLayoutDom = ReactDOM.findDOMNode(this);\n        this.headerDom = ReactDOM.findDOMNode(this.refs.photoHeader);\n        this.blogNavDom = document.getElementById('IdNav');\n\n        this.blogNavDom.classList.add('blog-photo-header');\n\n        window.addEventListener(\"scroll\", this.onscroll, false);\n    }\n\n    getPhotos(page) {\n        if ( this.state.isLoading ) return;\n        this.setState({\n            isLoading: true\n        });\n        Axios.get('/api/get/photoes', {params:{page}})\n            .then( res => {\n                let photoSrcs = this.addSrc(res.data.photoes);\n                this.setState(preState => {\n                    let photoes = preState.photoes.concat(photoSrcs)\n                    return {\n                        page,\n                        photoes,\n                        allPage: res.data.allPage,\n                        isLoading: false\n                    }\n                })\n            })\n    }\n\n    onscroll = (e) => {\n        e = e || window.event;\n        let _scrollTop =  window.pageYOffset\n                || (document.documentElement && document.documentElement.scrollTop)\n                || document.body.scrollTop\n                || 0;\n\n        if (_scrollTop >= (this.headerDom.offsetHeight - this.blogNavDom.offsetHeight)) {\n            this.blogNavDom.classList.remove('blog-photoes-header');\n        } else {\n            this.blogNavDom.classList.add('blog-photoes-header');\n        }\n\n        const { page, allPage } = this.state;\n        if ( (_scrollTop + document.documentElement.clientHeight) > (this.photoLayoutDom.offsetHeight - 150) ) {\n            (page < allPage) && this.getPhotos(page + 1);\n        }\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener(\"scroll\", this.onscroll);\n        this.blogNavDom.classList.remove('blog-photoes-header');\n    }\n\n    selectPhoto = (e, data) => {\n        this.setState({\n            isShowImageGallery: true,\n            imageGalleryIndex: data.index\n        })\n    }\n\n    addSrc(allphoto) {\n        let photoes = [],\n            banner = [];\n        if (allphoto && allphoto.length) {\n            allphoto.map( photo => {\n                let newPho = {\n                    src: `${IMG_URL}${photo.key}${IMG_QUERY}`,\n                    original: `${IMG_URL}${photo.key}${IMG_QUERY}`,\n                    thumbnail: `${IMG_URL}${photo.key}${IMG_QUERY}`,\n                    width: photo.width,\n                    height: photo.height,\n                    desc: photo.desc\n                };\n\n                photoes.push(newPho);\n            })\n        }\n\n        return photoes;\n    }\n\n\n    render() {\n        const { photoes, width, showPhotoView, currentPhotoIndex, isShowImageGallery, imageGalleryIndex, isLoading } = this.state;\n        return(\n            <div className=\"blog-photo-layout\">\n                <section className=\"photo-banner\" ref='photoHeader' style={{backgroundImage: `url(${ photoes[0] && photoes[0].src || '//cdn.liayal.com/14506926.jpg'})`} } >\n                    <img src={ photoes[0] && photoes[0].src || '//cdn.liayal.com/14506926.jpg'} alt=\"\"/>\n                    <div className=\"photo-banner-info\">\n                        <p className=\"small\" ><span>图记</span></p>\n                        <h2>{photoes[0] && photoes[0].desc ? photoes[0].desc : '一起老去'}</h2>\n                    </div>\n                </section>\n                <section className=\"middle-text tc\">\n                    <h2>我以一种笨拙的方式拍照</h2>\n                    <p>摄影是一种神奇的记录：照片记录了时间、风景、人物；可回放照片时才发现，原来它还记录了按下快门时的感触、思绪、心事……也许这就是为什么明明看到的是一张风景，却会让你想起谁</p>\n                </section>\n               <Measure bounds onResize={(contentRect) => this.setState({ width: contentRect.bounds.width  })}>\n                    {\n                        ({ measureRef  }) => {\n                            let columns = 2;\n                            if (width >= 480){\n                              columns = 3;\n                            }\n                            if (width >= 1024){\n                              columns = 4;\n                            }\n                            if (width >= 1824){\n                              columns = 5;\n                            }\n                            return <div ref={measureRef} className=\"photo-list\">\n                              <Gallery photos={ photoes.slice(1) } margin={ 4 } columns={columns} ImageComponent={ImageItem} onClick={ this.selectPhoto } />\n                            </div>\n                        }\n                    }\n                </Measure>\n                { isLoading ? <p className=\"loading\">加载中...</p> : null}\n                <ImageGallery images={ photoes.slice(1) } isShow={isShowImageGallery} startIndex={imageGalleryIndex} />\n            </div>\n        )\n    }\n}"]}]}