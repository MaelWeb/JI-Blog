{"remainingRequest":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js?{\"presets\":[]}!/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Comments/index.js","dependencies":[{"path":"/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Comments/index.js","mtime":1517559361927},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _stringify = require('babel-runtime/core-js/json/stringify');\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _message2 = require('antd/lib/message');\n\nvar _message3 = _interopRequireDefault(_message2);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _moment = require('moment');\n\nvar _moment2 = _interopRequireDefault(_moment);\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _Icon = require('../../../components/Icon');\n\nvar _Icon2 = _interopRequireDefault(_Icon);\n\nvar _Emoji = require('../../../components/Emoji');\n\nvar _Emoji2 = _interopRequireDefault(_Emoji);\n\nvar _CommentInput = require('../../../components/CommentInput');\n\nvar _CommentInput2 = _interopRequireDefault(_CommentInput);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar emojiStyle = {\n    height: 20\n};\n\n_moment2.default.locale('zh-cn');\n\nvar Comments = function (_Component) {\n    (0, _inherits3.default)(Comments, _Component);\n\n    function Comments(props) {\n        (0, _classCallCheck3.default)(this, Comments);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (Comments.__proto__ || (0, _getPrototypeOf2.default)(Comments)).call(this, props));\n\n        _this.preventDefault = function (e) {\n            e.preventDefault();\n        };\n\n        _this.exportComment = function (commentCont) {\n            var reply = _this.state.reply;\n\n            var user = /access\\_token/g.test(document.cookie) ? {\n                name: '记小栈',\n                email: 'mael.liang@live.com',\n                site: 'https://www.liayal.com',\n                avatar: 'https://cdn.liayal.com/image/logo_min.png'\n            } : window.localStorage.getItem('_liayal_user');\n\n            if (user && commentCont) {\n                _this.saveComment({\n                    user: typeof user == 'string' ? JSON.parse(user) : user,\n                    reply: reply ? reply.id : null,\n                    commentCont: commentCont\n                });\n            } else if (commentCont) {\n                _this.setState({\n                    showUserInfo: true,\n                    commentCont: commentCont\n                });\n            }\n        };\n\n        _this.commentSubmit = function () {\n            var name = _this.refs.userName.value,\n                email = _this.refs.userEamil.value,\n                site = _this.refs.userSite.value,\n                emailReg = /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$/g;\n            var _this$state = _this.state,\n                reply = _this$state.reply,\n                commentCont = _this$state.commentCont;\n\n\n            if (!email || !name) return _message3.default.info('填一下昵称和邮箱呗！');\n\n            if (!emailReg.test(email)) return _message3.default.info('邮箱格式不正确呀！');\n\n            window.localStorage.setItem('_liayal_user', (0, _stringify2.default)({ name: name, email: email, site: site }));\n\n            _this.saveComment({\n                user: { name: name, email: email, site: site },\n                reply: reply ? reply.id : null,\n                commentCont: commentCont\n            });\n        };\n\n        _this.commentCancle = function () {\n            _this.setState({\n                showUserInfo: false\n            });\n        };\n\n        _this.showReplyModal = function (comment) {\n            _this.setState({\n                isShowReplyModal: true,\n                reply: comment\n            });\n        };\n\n        _this.closeReplyModal = function () {\n            _this.setState({\n                isShowReplyModal: false\n            });\n        };\n\n        _this.getTimeString = function (date) {\n            var now = new Date(),\n                nowDate = now.getDate(),\n                createTime = new Date(date),\n                createDate = createTime.getDate(),\n                diff = now.getTime() - date;\n            // 1分钟内\n            if (diff < 1000 * 60) {\n                return '刚刚';\n            } else if (diff < 1000 * 60 * 60) {\n                // 1小时内\n                return Math.ceil(diff / (1000 * 60)) + '\\u5206\\u949F\\u524D';\n            } else if (diff < 1000 * 60 * 60 * 24 && nowDate == createDate) {\n                // 当天内\n                return '\\u4ECA\\u5929 ' + (0, _moment2.default)(date).format('HH:mm');\n            } else if (now.getYear() == createTime.getYear()) {\n                return (0, _moment2.default)(date).format('MM-DD HH:mm');\n            } else {\n                return (0, _moment2.default)(date).format('lll');\n            }\n        };\n\n        _this.state = {\n            showUserInfo: false,\n            isShowReplyModal: false,\n            reply: null,\n            comments: props.comments,\n            commentCont: null\n        };\n\n        _this.caretIndex = 0;\n        return _this;\n    }\n\n    (0, _createClass3.default)(Comments, [{\n        key: 'componentWillReceiveProps',\n        value: function componentWillReceiveProps(nextProps) {\n            this.setState({\n                comments: nextProps.comments\n            });\n        }\n    }, {\n        key: 'saveComment',\n        value: function saveComment(data) {\n            var _this2 = this;\n\n            var articleid = this.props.articleid;\n\n            var comments = this.state.comments;\n            _axios2.default.post('/api/create/comment', (0, _extends3.default)({}, data, { articleid: articleid })).then(function (res) {\n                var resdata = res.data;\n                if (resdata.code == 200) {\n                    comments.unshift(resdata.comment);\n                    data.reply ? _this2.refs.replyInput.clearTextarea() : _this2.refs.commentInput.clearTextarea();\n                    _this2.setState({\n                        showUserInfo: false,\n                        isShowReplyModal: false,\n                        reply: null,\n                        comments: comments,\n                        commentCont: null\n                    });\n                } else {\n                    _message3.default.warning(resdata.message);\n                }\n            }).catch(function (err) {\n                _message3.default.warning('发布失败');\n            });\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _this3 = this;\n\n            var _state = this.state,\n                showUserInfo = _state.showUserInfo,\n                isShowReplyModal = _state.isShowReplyModal,\n                reply = _state.reply,\n                comments = _state.comments;\n\n            return _react2.default.createElement(\n                'article',\n                { className: 'blog-comment' },\n                _react2.default.createElement(_CommentInput2.default, { exportComment: this.exportComment, ref: 'commentInput' }),\n                _react2.default.createElement(\n                    'div',\n                    { className: 'comment-list' },\n                    comments.length ? comments.map(function (comment, index) {\n                        return _react2.default.createElement(\n                            'div',\n                            { className: 'comment-item clearfix border-b', key: index },\n                            _react2.default.createElement(\n                                'div',\n                                { className: 'comment-avatar fl' },\n                                comment.user && comment.user.avatar ? _react2.default.createElement('img', { src: comment.user.avatar, alt: '', className: 'avatar' }) : _react2.default.createElement(_Icon2.default, { type: 'avatar' })\n                            ),\n                            _react2.default.createElement(\n                                'div',\n                                { className: 'comment-body fl' },\n                                _react2.default.createElement(\n                                    'h6',\n                                    null,\n                                    comment.user.name,\n                                    _react2.default.createElement(\n                                        'small',\n                                        null,\n                                        _this3.getTimeString(comment.createTime)\n                                    )\n                                ),\n                                comment.reply ? _react2.default.createElement(\n                                    _Emoji2.default,\n                                    { style: emojiStyle },\n                                    _react2.default.createElement(\n                                        'blockquote',\n                                        null,\n                                        '@',\n                                        comment.reply.user.name,\n                                        ': ',\n                                        comment.reply.commentCont\n                                    )\n                                ) : null,\n                                _react2.default.createElement(\n                                    _Emoji2.default,\n                                    { style: emojiStyle },\n                                    _react2.default.createElement(\n                                        'p',\n                                        null,\n                                        comment.commentCont\n                                    )\n                                ),\n                                _react2.default.createElement(\n                                    'div',\n                                    { className: 'comment-reply' },\n                                    _react2.default.createElement(_Icon2.default, { type: 'reply', onClick: function onClick(e) {\n                                            _this3.showReplyModal(comment);\n                                        } })\n                                )\n                            )\n                        );\n                    }) : null\n                ),\n                _react2.default.createElement(\n                    'div',\n                    { className: 'comment-modal', hidden: !showUserInfo, style: { zIndex: 5 }, ref: 'UserModal' },\n                    _react2.default.createElement(\n                        'div',\n                        { className: 'comment-user-modal-form' },\n                        _react2.default.createElement('img', { src: '//cdn.liayal.com/image/logo.png', alt: '' }),\n                        _react2.default.createElement('input', { type: 'text', name: 'name', placeholder: '\\u6635\\u79F0(\\u5FC5\\u586B)', ref: 'userName' }),\n                        _react2.default.createElement('input', { type: 'text', name: 'email', placeholder: 'xxxx@qq.com(\\u5FC5\\u586B)', ref: 'userEamil' }),\n                        _react2.default.createElement('input', { type: 'text', name: 'site', placeholder: 'www.yourblog.com', ref: 'userSite' }),\n                        _react2.default.createElement(\n                            'div',\n                            { className: 'btns' },\n                            _react2.default.createElement(\n                                'button',\n                                { onClick: this.commentCancle },\n                                '\\u53D6\\u6D88'\n                            ),\n                            _react2.default.createElement(\n                                'button',\n                                { onClick: this.commentSubmit },\n                                '\\u786E\\u8BA4'\n                            )\n                        )\n                    )\n                ),\n                _react2.default.createElement(\n                    'div',\n                    { className: 'comment-modal', hidden: !isShowReplyModal, ref: 'ReplyModal' },\n                    _react2.default.createElement(\n                        'div',\n                        { className: 'comment-reply-from' },\n                        _react2.default.createElement(\n                            'h6',\n                            { className: 'tl' },\n                            '\\u56DE\\u590D\\uFF1A',\n                            reply && reply.user.name,\n                            ' ',\n                            _react2.default.createElement(_Icon2.default, { type: 'close-x comment-close', onClick: this.closeReplyModal })\n                        ),\n                        _react2.default.createElement(_CommentInput2.default, { exportComment: this.exportComment, ref: 'replyInput' })\n                    )\n                )\n            );\n        }\n    }]);\n    return Comments;\n}(_react.Component);\n\nComments.defaultProps = {\n    articleid: '',\n    comments: []\n};\nComments.defaultPropTypes = {\n    comments: _propTypes2.default.array\n};\nexports.default = Comments;",null]}