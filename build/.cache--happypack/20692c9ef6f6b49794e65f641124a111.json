{"remainingRequest":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js?{\"presets\":[]}!/Users/mael.liang/Workspace/node-koa-test/web/page/admin/ArticleManage/index.js","dependencies":[{"path":"/Users/mael.liang/Workspace/node-koa-test/web/page/admin/ArticleManage/index.js","mtime":1519640503917},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _pagination = require('antd/lib/pagination');\n\nvar _pagination2 = _interopRequireDefault(_pagination);\n\nvar _spin = require('antd/lib/spin');\n\nvar _spin2 = _interopRequireDefault(_spin);\n\nvar _alert = require('antd/lib/alert');\n\nvar _alert2 = _interopRequireDefault(_alert);\n\nvar _col = require('antd/lib/col');\n\nvar _col2 = _interopRequireDefault(_col);\n\nvar _card = require('antd/lib/card');\n\nvar _card2 = _interopRequireDefault(_card);\n\nvar _icon = require('antd/lib/icon');\n\nvar _icon2 = _interopRequireDefault(_icon);\n\nvar _modal = require('antd/lib/modal');\n\nvar _modal2 = _interopRequireDefault(_modal);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _radio = require('antd/lib/radio');\n\nvar _radio2 = _interopRequireDefault(_radio);\n\nvar _button = require('antd/lib/button');\n\nvar _button2 = _interopRequireDefault(_button);\n\nvar _layout = require('antd/lib/layout');\n\nvar _layout2 = _interopRequireDefault(_layout);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactRouterDom = require('react-router-dom');\n\nvar _moment = require('moment');\n\nvar _moment2 = _interopRequireDefault(_moment);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _reactMasonryComponent = require('react-masonry-component');\n\nvar _reactMasonryComponent2 = _interopRequireDefault(_reactMasonryComponent);\n\nrequire('./index.less');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Header = _layout2.default.Header,\n    Content = _layout2.default.Content,\n    Footer = _layout2.default.Footer;\n\nvar ButtonGroup = _button2.default.Group;\nvar RadioGroup = _radio2.default.Group;\n\nvar ArticleManege = function (_Component) {\n    (0, _inherits3.default)(ArticleManege, _Component);\n\n    function ArticleManege(props) {\n        (0, _classCallCheck3.default)(this, ArticleManege);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (ArticleManege.__proto__ || (0, _getPrototypeOf2.default)(ArticleManege)).call(this, props));\n\n        _this.deleteArticle = function (article) {\n            _modal2.default.confirm({\n                title: '确定删除文章?',\n                content: '文章删除后不可恢复',\n                okText: '删除',\n                okType: 'danger',\n                cancelText: '取消',\n                onOk: function onOk() {\n                    return _this.doDelete(article.id);\n                }\n            });\n        };\n\n        _this.changePage = function (page) {\n            _this.getArticles(page);\n        };\n\n        _this.getTimeString = function (date) {\n            var now = new Date(),\n                nowDate = now.getDate(),\n                createTime = new Date(date),\n                createDate = createTime.getDate(),\n                diff = now.getTime() - date;\n            // 1分钟内\n            if (diff < 1000 * 60) {\n                return '刚刚';\n            } else if (diff < 1000 * 60 * 60) {\n                // 1小时内\n                return Math.ceil(diff / (1000 * 60)) + '\\u5206\\u949F\\u524D';\n            } else if (diff < 1000 * 60 * 60 * 24 && nowDate == createDate) {\n                // 当天内\n                return '\\u4ECA\\u5929 ' + (0, _moment2.default)(date).format('HH:mm');\n            } else if (now.getYear() == createTime.getYear()) {\n                return (0, _moment2.default)(date).format('MM-DD HH:mm');\n            } else {\n                return (0, _moment2.default)(date).format('Y-MM-DD');\n            }\n        };\n\n        _this.exportOrRecallArticle = function (article) {\n            if (article.publish) {\n                _this.recallArticle(article.id);\n            } else {\n                _this.setState({\n                    isCategoryModalShow: true,\n                    category: article.category,\n                    articleToExport: article\n                });\n            }\n        };\n\n        _this.exportModalOk = function () {\n            var _this$state = _this.state,\n                articleToExport = _this$state.articleToExport,\n                category = _this$state.category;\n\n            _axios2.default.post('/api/publish/article/' + articleToExport.id, { category: category }).then(function (res) {\n                _this.context.showMessage(res.data.message);\n                _this.setState({\n                    isCategoryModalShow: false\n                });\n                _this.getArticles();\n            }).catch(function (err) {\n                _this.context.showMessage('服务器错误');\n            });\n        };\n\n        _this.recallArticle = function (aid) {\n            _axios2.default.post('/api/recall/article/' + aid).then(function (res) {\n                _this.context.showMessage(res.data.message);\n                _this.getArticles();\n            }).catch(function (err) {\n                _this.context.showMessage('服务器错误');\n            });\n        };\n\n        _this.exportModalCancle = function () {\n            _this.setState({\n                isCategoryModalShow: false\n            });\n        };\n\n        _this.onRadioChange = function (e) {\n            _this.setState({\n                category: e.target.value\n            });\n        };\n\n        _this.state = {\n            pageSize: 12,\n            articles: [],\n            one: [],\n            page: 1,\n            allNum: 0,\n            isCategoryModalShow: false,\n            articleToExport: {},\n            category: 'DEFAULT'\n        };\n\n        _this.hasLoad = false;\n        return _this;\n    }\n\n    (0, _createClass3.default)(ArticleManege, [{\n        key: 'componentWillMount',\n        value: function componentWillMount() {\n            this.getArticles(1);\n        }\n    }, {\n        key: 'goEdit',\n        value: function goEdit(article) {\n            this.props.history.push({\n                pathname: '/edit',\n                search: '?aid=' + article.id\n            });\n        }\n    }, {\n        key: 'getOne',\n        value: function getOne() {\n            var _this2 = this;\n\n            _axios2.default.get('/api/one').then(function (res) {\n                _this2.setState({\n                    one: res.data.data\n                });\n            });\n        }\n    }, {\n        key: 'getArticles',\n        value: function getArticles(_page) {\n            var _this3 = this;\n\n            var _state = this.state,\n                pageSize = _state.pageSize,\n                page = _state.page;\n\n            _axios2.default.get('/api/get/all/articles', {\n                params: {\n                    page: _page || page,\n                    tag: '',\n                    size: pageSize\n                }\n            }).then(function (res) {\n                _this3.hasLoad = true;\n                _this3.setState({\n                    articles: res.data.articles || [],\n                    page: res.data.page,\n                    allNum: res.data.allNum\n                });\n            });\n        }\n    }, {\n        key: 'doDelete',\n        value: function doDelete(id) {\n            var _this4 = this;\n\n            return _axios2.default.delete('/api/article/' + id).then(function (res) {\n                _this4.context.showMessage(res.data.message);\n                if (res.data.code == 200) {\n                    _this4.getArticles();\n                }\n            }).catch(function (err) {\n                _this4.context.showMessage(err);\n            });\n        }\n    }, {\n        key: 'showArticles',\n        value: function showArticles() {\n            var _this5 = this;\n\n            var articles = this.state.articles;\n\n            var bodyStyle = { padding: '15px' };\n\n            return articles.length ? articles.map(function (article) {\n                return _react2.default.createElement(\n                    _col2.default,\n                    { span: 8, key: article.id },\n                    _react2.default.createElement(\n                        _card2.default,\n                        { title: article.title, hoverable: true, extra: _react2.default.createElement(_icon2.default, { type: 'delete', className: 'article-delete', onClick: function onClick(e) {\n                                    return _this5.deleteArticle(article);\n                                } }), bodyStyle: bodyStyle },\n                        _react2.default.createElement(\n                            'div',\n                            { className: 'article-content' },\n                            article.abstract || article.content.substr(0, 100)\n                        ),\n                        _react2.default.createElement(\n                            'div',\n                            { className: 'article-footer clearfix' },\n                            _react2.default.createElement(\n                                'span',\n                                null,\n                                _this5.getTimeString(article.createTime)\n                            ),\n                            _react2.default.createElement(\n                                ButtonGroup,\n                                { className: 'fr' },\n                                _react2.default.createElement(\n                                    _button2.default,\n                                    { ghost: true, type: 'primary', size: 'small', onClick: function onClick(e) {\n                                            _this5.exportOrRecallArticle(article);\n                                        } },\n                                    article.publish ? _react2.default.createElement(\n                                        'span',\n                                        null,\n                                        _react2.default.createElement(_icon2.default, { type: 'rollback' }),\n                                        '\\u64A4\\u56DE'\n                                    ) : _react2.default.createElement(\n                                        'span',\n                                        null,\n                                        _react2.default.createElement(_icon2.default, { type: 'export' }),\n                                        '\\u53D1\\u5E03'\n                                    )\n                                ),\n                                _react2.default.createElement(\n                                    _button2.default,\n                                    { ghost: true, type: 'primary', size: 'small', onClick: function onClick() {\n                                            _this5.goEdit(article);\n                                        } },\n                                    '\\u7F16\\u8F91',\n                                    _react2.default.createElement(_icon2.default, { type: 'edit' })\n                                )\n                            )\n                        )\n                    )\n                );\n            }) : null;\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _state2 = this.state,\n                articles = _state2.articles,\n                page = _state2.page,\n                allNum = _state2.allNum,\n                pageSize = _state2.pageSize,\n                isCategoryModalShow = _state2.isCategoryModalShow,\n                articleToExport = _state2.articleToExport,\n                category = _state2.category;\n\n            return _react2.default.createElement(\n                _layout2.default,\n                { className: 'article-manage-layout' },\n                _react2.default.createElement(\n                    Header,\n                    { className: 'article-manage-header clearfix' },\n                    _react2.default.createElement(\n                        'h3',\n                        null,\n                        '\\u6587\\u7AE0\\u7BA1\\u7406'\n                    ),\n                    _react2.default.createElement(\n                        _reactRouterDom.Link,\n                        { to: '/edit', className: 'fr' },\n                        _react2.default.createElement(\n                            _button2.default,\n                            { icon: 'plus' },\n                            '\\u5199\\u6587\\u7AE0'\n                        )\n                    )\n                ),\n                _react2.default.createElement(\n                    Content,\n                    { className: 'article-manage-content' },\n                    _react2.default.createElement(\n                        _reactMasonryComponent2.default,\n                        { className: 'article-list' },\n                        articles.length ? this.showArticles() : _react2.default.createElement(\n                            _spin2.default,\n                            { tip: 'Loading...', size: 'large', wrapperClassName: 'loading' },\n                            _react2.default.createElement(_alert2.default, {\n                                description: '\\u6587\\u7AE0\\u5217\\u8868\\u52A0\\u8F7D\\u4E2D...',\n                                type: 'info'\n                            })\n                        )\n                    )\n                ),\n                articles.length ? _react2.default.createElement(\n                    Footer,\n                    null,\n                    _react2.default.createElement(_pagination2.default, { className: 'article-pn', showQuickJumper: true, current: page, total: allNum, onChange: this.changePage, pageSize: pageSize })\n                ) : null,\n                _react2.default.createElement(\n                    _modal2.default,\n                    {\n                        title: '\\u9009\\u62E9\\u53D1\\u5E03\\u677F\\u5757',\n                        visible: isCategoryModalShow,\n                        onOk: this.exportModalOk,\n                        mask: false,\n                        onCancel: this.exportModalCancle },\n                    _react2.default.createElement(\n                        RadioGroup,\n                        { onChange: this.onRadioChange, value: category },\n                        _react2.default.createElement(\n                            _radio2.default,\n                            { value: 'DEFAULT' },\n                            '\\u9996\\u9875'\n                        ),\n                        _react2.default.createElement(\n                            _radio2.default,\n                            { value: 'TRAVEL' },\n                            '\\u6E38\\u8BB0'\n                        )\n                    )\n                )\n            );\n        }\n    }]);\n    return ArticleManege;\n}(_react.Component);\n\nArticleManege.contextTypes = {\n    showMessage: _propTypes2.default.func\n};\nexports.default = ArticleManege;",null]}