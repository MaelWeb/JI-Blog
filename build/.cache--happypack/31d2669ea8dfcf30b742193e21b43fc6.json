{"remainingRequest":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js?{\"presets\":[\"react-hmre\"]}!/Users/mael.liang/Workspace/node-koa-test/web/page/admin/ArticleManage/index.js","dependencies":[{"path":"/Users/mael.liang/Workspace/node-koa-test/web/page/admin/ArticleManage/index.js","mtime":1517908157389},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _pagination = require('antd/lib/pagination');\n\nvar _pagination2 = _interopRequireDefault(_pagination);\n\nvar _spin = require('antd/lib/spin');\n\nvar _spin2 = _interopRequireDefault(_spin);\n\nvar _alert = require('antd/lib/alert');\n\nvar _alert2 = _interopRequireDefault(_alert);\n\nvar _col = require('antd/lib/col');\n\nvar _col2 = _interopRequireDefault(_col);\n\nvar _card = require('antd/lib/card');\n\nvar _card2 = _interopRequireDefault(_card);\n\nvar _icon = require('antd/lib/icon');\n\nvar _icon2 = _interopRequireDefault(_icon);\n\nvar _modal = require('antd/lib/modal');\n\nvar _modal2 = _interopRequireDefault(_modal);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _radio = require('antd/lib/radio');\n\nvar _radio2 = _interopRequireDefault(_radio);\n\nvar _button = require('antd/lib/button');\n\nvar _button2 = _interopRequireDefault(_button);\n\nvar _layout = require('antd/lib/layout');\n\nvar _layout2 = _interopRequireDefault(_layout);\n\nvar _index = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/redbox-react/lib/index.js');\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _index3 = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/react-transform-catch-errors/lib/index.js');\n\nvar _index4 = _interopRequireDefault(_index3);\n\nvar _react2 = require('react');\n\nvar _react3 = _interopRequireDefault(_react2);\n\nvar _index5 = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/react-transform-hmr/lib/index.js');\n\nvar _index6 = _interopRequireDefault(_index5);\n\nvar _class, _temp;\n\nvar _reactRouterDom = require('react-router-dom');\n\nvar _moment = require('moment');\n\nvar _moment2 = _interopRequireDefault(_moment);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _reactMasonryComponent = require('react-masonry-component');\n\nvar _reactMasonryComponent2 = _interopRequireDefault(_reactMasonryComponent);\n\nrequire('./index.less');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _components = {\n    ArticleManege: {\n        displayName: 'ArticleManege'\n    }\n};\n\nvar _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformHmrLibIndexJs2 = (0, _index6.default)({\n    filename: '/Users/mael.liang/Workspace/node-koa-test/web/page/admin/ArticleManage/index.js',\n    components: _components,\n    locals: [module],\n    imports: [_react3.default]\n});\n\nvar _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformCatchErrorsLibIndexJs2 = (0, _index4.default)({\n    filename: '/Users/mael.liang/Workspace/node-koa-test/web/page/admin/ArticleManage/index.js',\n    components: _components,\n    locals: [],\n    imports: [_react3.default, _index2.default]\n});\n\nfunction _wrapComponent(id) {\n    return function (Component) {\n        return _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformHmrLibIndexJs2(_UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformCatchErrorsLibIndexJs2(Component, id), id);\n    };\n}\n\nvar Header = _layout2.default.Header,\n    Content = _layout2.default.Content,\n    Footer = _layout2.default.Footer;\n\nvar ButtonGroup = _button2.default.Group;\nvar RadioGroup = _radio2.default.Group;\n\nvar ArticleManege = _wrapComponent('ArticleManege')((_temp = _class = function (_Component) {\n    (0, _inherits3.default)(ArticleManege, _Component);\n\n    function ArticleManege(props) {\n        (0, _classCallCheck3.default)(this, ArticleManege);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (ArticleManege.__proto__ || (0, _getPrototypeOf2.default)(ArticleManege)).call(this, props));\n\n        _this.deleteArticle = function (article) {\n            _modal2.default.confirm({\n                title: '确定删除文章?',\n                content: '文章删除后不可恢复',\n                okText: '删除',\n                okType: 'danger',\n                cancelText: '取消',\n                onOk: function onOk() {\n                    return _this.doDelete(article.id);\n                }\n            });\n        };\n\n        _this.changePage = function (page) {\n            _this.getArticles(page);\n        };\n\n        _this.getTimeString = function (date) {\n            var now = new Date(),\n                nowDate = now.getDate(),\n                createTime = new Date(date),\n                createDate = createTime.getDate(),\n                diff = now.getTime() - date;\n            // 1分钟内\n            if (diff < 1000 * 60) {\n                return '刚刚';\n            } else if (diff < 1000 * 60 * 60) {\n                // 1小时内\n                return Math.ceil(diff / (1000 * 60)) + '\\u5206\\u949F\\u524D';\n            } else if (diff < 1000 * 60 * 60 * 24 && nowDate == createDate) {\n                // 当天内\n                return '\\u4ECA\\u5929 ' + (0, _moment2.default)(date).format('HH:mm');\n            } else if (now.getYear() == createTime.getYear()) {\n                return (0, _moment2.default)(date).format('MM-DD HH:mm');\n            } else {\n                return (0, _moment2.default)(date).format('Y-MM-DD');\n            }\n        };\n\n        _this.exportOrRecallArticle = function (article) {\n            if (article.publish) {\n                _this.recallArticle(article.id);\n            } else {\n                _this.setState({\n                    isCategoryModalShow: true,\n                    category: article.category,\n                    articleToExport: article\n                });\n            }\n        };\n\n        _this.exportModalOk = function () {\n            var _this$state = _this.state,\n                articleToExport = _this$state.articleToExport,\n                category = _this$state.category;\n\n            _axios2.default.post('/api/publish/article/' + articleToExport.id, { category: category }).then(function (res) {\n                _this.context.showMessage(res.data.message);\n                _this.setState({\n                    isCategoryModalShow: false\n                });\n                _this.getArticles();\n            }).catch(function (err) {\n                _this.context.showMessage('服务器错误');\n            });\n        };\n\n        _this.recallArticle = function (aid) {\n            _axios2.default.post('/api/recall/article/' + aid).then(function (res) {\n                _this.context.showMessage(res.data.message);\n                _this.getArticles();\n            }).catch(function (err) {\n                _this.context.showMessage('服务器错误');\n            });\n        };\n\n        _this.exportModalCancle = function () {\n            _this.setState({\n                isCategoryModalShow: false\n            });\n        };\n\n        _this.onRadioChange = function (e) {\n            _this.setState({\n                category: e.target.value\n            });\n        };\n\n        _this.state = {\n            pageSize: 12,\n            articles: [],\n            one: [],\n            page: 1,\n            allNum: 0,\n            isCategoryModalShow: false,\n            articleToExport: {},\n            category: 'DEFAULT'\n        };\n\n        _this.hasLoad = false;\n        return _this;\n    }\n\n    (0, _createClass3.default)(ArticleManege, [{\n        key: 'componentWillMount',\n        value: function componentWillMount() {\n            this.getArticles(1);\n        }\n    }, {\n        key: 'goEdit',\n        value: function goEdit(article) {\n            this.props.history.push({\n                pathname: '/edit',\n                search: '?aid=' + article.id\n            });\n        }\n    }, {\n        key: 'getOne',\n        value: function getOne() {\n            var _this2 = this;\n\n            _axios2.default.get('/api/one').then(function (res) {\n                _this2.setState({\n                    one: res.data.data\n                });\n            });\n        }\n    }, {\n        key: 'getArticles',\n        value: function getArticles(_page) {\n            var _this3 = this;\n\n            var _state = this.state,\n                pageSize = _state.pageSize,\n                page = _state.page;\n\n            _axios2.default.get('/api/get/all/articles', {\n                params: {\n                    page: _page || page,\n                    tag: '',\n                    size: pageSize\n                }\n            }).then(function (res) {\n                _this3.hasLoad = true;\n                _this3.setState({\n                    articles: res.data.articles || [],\n                    page: res.data.page,\n                    allNum: res.data.allNum\n                });\n            });\n        }\n    }, {\n        key: 'doDelete',\n        value: function doDelete(id) {\n            var _this4 = this;\n\n            return _axios2.default.delete('/api/article/' + id).then(function (res) {\n                _this4.context.showMessage(res.data.message);\n                if (res.data.code == 200) {\n                    _this4.getArticles();\n                }\n            }).catch(function (err) {\n                _this4.context.showMessage(err);\n            });\n        }\n    }, {\n        key: 'showArticles',\n        value: function showArticles() {\n            var _this5 = this;\n\n            var articles = this.state.articles;\n\n            var bodyStyle = { padding: '15px' };\n\n            return articles.length ? articles.map(function (article) {\n                return _react3.default.createElement(\n                    _col2.default,\n                    { span: 8, key: article.id },\n                    _react3.default.createElement(\n                        _card2.default,\n                        { title: article.title, hoverable: true, extra: _react3.default.createElement(_icon2.default, { type: 'delete', className: 'article-delete', onClick: function onClick(e) {\n                                    return _this5.deleteArticle(article);\n                                } }), bodyStyle: bodyStyle },\n                        _react3.default.createElement(\n                            'div',\n                            { className: 'article-content' },\n                            article.abstract || article.content.substr(0, 100)\n                        ),\n                        _react3.default.createElement(\n                            'div',\n                            { className: 'article-footer clearfix' },\n                            _react3.default.createElement(\n                                'span',\n                                null,\n                                _this5.getTimeString(article.createTime)\n                            ),\n                            _react3.default.createElement(\n                                ButtonGroup,\n                                { className: 'fr' },\n                                _react3.default.createElement(\n                                    _button2.default,\n                                    { ghost: true, type: 'primary', size: 'small', onClick: function onClick(e) {\n                                            _this5.exportOrRecallArticle(article);\n                                        } },\n                                    article.publish ? _react3.default.createElement(\n                                        'span',\n                                        null,\n                                        _react3.default.createElement(_icon2.default, { type: 'rollback' }),\n                                        '\\u64A4\\u56DE'\n                                    ) : _react3.default.createElement(\n                                        'span',\n                                        null,\n                                        _react3.default.createElement(_icon2.default, { type: 'export' }),\n                                        '\\u53D1\\u5E03'\n                                    )\n                                ),\n                                _react3.default.createElement(\n                                    _button2.default,\n                                    { ghost: true, type: 'primary', size: 'small', onClick: function onClick() {\n                                            _this5.goEdit(article);\n                                        } },\n                                    '\\u7F16\\u8F91',\n                                    _react3.default.createElement(_icon2.default, { type: 'edit' })\n                                )\n                            )\n                        )\n                    )\n                );\n            }) : null;\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _state2 = this.state,\n                articles = _state2.articles,\n                page = _state2.page,\n                allNum = _state2.allNum,\n                pageSize = _state2.pageSize,\n                isCategoryModalShow = _state2.isCategoryModalShow,\n                articleToExport = _state2.articleToExport,\n                category = _state2.category;\n\n            return _react3.default.createElement(\n                _layout2.default,\n                { className: 'article-manage-layout' },\n                _react3.default.createElement(\n                    Header,\n                    { className: 'article-manage-header clearfix' },\n                    _react3.default.createElement(\n                        'h2',\n                        null,\n                        '\\u6587\\u7AE0\\u7BA1\\u7406'\n                    ),\n                    _react3.default.createElement(\n                        _reactRouterDom.Link,\n                        { to: '/edit', className: 'fr' },\n                        _react3.default.createElement(\n                            _button2.default,\n                            { icon: 'plus' },\n                            '\\u5199\\u6587\\u7AE0'\n                        )\n                    )\n                ),\n                _react3.default.createElement(\n                    Content,\n                    { className: 'article-manage-content' },\n                    _react3.default.createElement(\n                        _reactMasonryComponent2.default,\n                        { className: 'article-list' },\n                        articles.length ? this.showArticles() : _react3.default.createElement(\n                            _spin2.default,\n                            { tip: 'Loading...', size: 'large', wrapperClassName: 'loading' },\n                            _react3.default.createElement(_alert2.default, {\n                                description: '\\u6587\\u7AE0\\u5217\\u8868\\u52A0\\u8F7D\\u4E2D...',\n                                type: 'info'\n                            })\n                        )\n                    )\n                ),\n                articles.length ? _react3.default.createElement(\n                    Footer,\n                    null,\n                    _react3.default.createElement(_pagination2.default, { className: 'article-pn', showQuickJumper: true, current: page, total: allNum, onChange: this.changePage, pageSize: pageSize })\n                ) : null,\n                _react3.default.createElement(\n                    _modal2.default,\n                    {\n                        title: '\\u9009\\u62E9\\u53D1\\u5E03\\u677F\\u5757',\n                        visible: isCategoryModalShow,\n                        onOk: this.exportModalOk,\n                        mask: false,\n                        onCancel: this.exportModalCancle },\n                    _react3.default.createElement(\n                        RadioGroup,\n                        { onChange: this.onRadioChange, value: category },\n                        _react3.default.createElement(\n                            _radio2.default,\n                            { value: 'DEFAULT' },\n                            '\\u9996\\u9875'\n                        ),\n                        _react3.default.createElement(\n                            _radio2.default,\n                            { value: 'TRAVEL' },\n                            '\\u6E38\\u8BB0'\n                        )\n                    )\n                )\n            );\n        }\n    }]);\n    return ArticleManege;\n}(_react2.Component), _class.contextTypes = {\n    showMessage: _propTypes2.default.func\n}, _temp));\n\nexports.default = ArticleManege;",{"version":3,"sources":["web/page/admin/ArticleManage/index.js"],"names":["Header","Content","Footer","ButtonGroup","Group","RadioGroup","props","deleteArticle","confirm","title","content","okText","okType","cancelText","onOk","doDelete","article","id","changePage","getArticles","page","getTimeString","date","now","Date","nowDate","getDate","createTime","createDate","diff","getTime","Math","ceil","format","getYear","exportOrRecallArticle","publish","recallArticle","setState","isCategoryModalShow","category","articleToExport","exportModalOk","state","post","then","context","showMessage","res","data","message","catch","aid","exportModalCancle","onRadioChange","e","target","value","pageSize","articles","one","allNum","hasLoad","history","push","pathname","search","get","_page","params","tag","size","delete","code","err","bodyStyle","padding","length","map","abstract","substr","goEdit","showArticles","contextTypes","func"],"mappings":"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","file":"index.js","sourceRoot":"/Users/mael.liang/Workspace/node-koa-test","sourcesContent":["import React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Layout, Icon, Card, Col, Button, Modal, Pagination, Radio, Spin, Alert} from 'antd';\nimport Moment from 'moment';\nimport PropTypes from 'prop-types';\nimport Axios from 'axios';\nimport Masonry from 'react-masonry-component';\nimport './index.less';\n\nconst { Header, Content, Footer } = Layout;\nconst ButtonGroup = Button.Group;\nconst RadioGroup = Radio.Group;\n\nexport default class ArticleManege extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            pageSize: 12,\n            articles: [],\n            one: [],\n            page: 1,\n            allNum: 0,\n            isCategoryModalShow: false,\n            articleToExport: {},\n            category: 'DEFAULT'\n        };\n\n        this.hasLoad = false;\n    }\n\n    static contextTypes = {\n        showMessage: PropTypes.func\n    };\n\n    componentWillMount() {\n        this.getArticles(1);\n    }\n\n    goEdit(article) {\n        this.props.history.push({\n            pathname: '/edit',\n            search: `?aid=${article.id}`\n        });\n    }\n\n    getOne() {\n        Axios.get('/api/one')\n            .then( res => {\n                this.setState({\n                    one: res.data.data\n                })\n            });\n    }\n\n    getArticles(_page) {\n        const { pageSize, page } = this.state;\n        Axios.get('/api/get/all/articles', {\n            params: {\n                page: _page || page,\n                tag: '',\n                size: pageSize\n            }\n        })\n        .then( res => {\n            this.hasLoad = true;\n            this.setState({\n                articles: res.data.articles || [],\n                page: res.data.page,\n                allNum: res.data.allNum\n            })\n        });\n    }\n\n    doDelete(id) {\n        return Axios\n            .delete(`/api/article/${id}`)\n            .then( res => {\n                this.context.showMessage(res.data.message);\n                if (res.data.code == 200) {\n                    this.getArticles();\n                }\n            })\n            .catch( err => {\n                this.context.showMessage(err);\n            })\n    }\n\n    deleteArticle = article => {\n        Modal.confirm({\n            title: '确定删除文章?',\n            content: '文章删除后不可恢复',\n            okText: '删除',\n            okType: 'danger',\n            cancelText: '取消',\n            onOk: () => {\n                return this.doDelete(article.id);\n            }\n        });\n    }\n\n    changePage = page => {\n        this.getArticles(page);\n    }\n\n    getTimeString = (date) => {\n        let now = new Date(),\n            nowDate = now.getDate(),\n            createTime = new Date(date),\n            createDate = createTime.getDate(),\n            diff = now.getTime() - date;\n        // 1分钟内\n        if (diff < 1000 * 60 ) {\n            return '刚刚';\n        } else if (diff < 1000 * 60 * 60) {\n            // 1小时内\n            return `${Math.ceil(diff / (1000 * 60))}分钟前`;\n        } else if ( (diff < 1000 * 60 * 60 * 24) && (nowDate == createDate) ) {\n            // 当天内\n            return `今天 ${Moment(date).format('HH:mm')}`;\n        } else if (now.getYear() == createTime.getYear() ) {\n            return Moment(date).format('MM-DD HH:mm');\n        } else {\n            return Moment(date).format('Y-MM-DD');\n        }\n    }\n\n    exportOrRecallArticle = (article) => {\n        if (article.publish) {\n            this.recallArticle(article.id)\n        } else {\n            this.setState({\n                isCategoryModalShow: true,\n                category: article.category,\n                articleToExport: article\n            });\n        }\n    }\n\n    exportModalOk = () => {\n        const { articleToExport, category } = this.state;\n        Axios.post(`/api/publish/article/${articleToExport.id}`, {category})\n            .then( res => {\n                this.context.showMessage(res.data.message);\n                this.setState({\n                    isCategoryModalShow: false,\n                });\n                this.getArticles();\n            })\n            .catch( err => {\n                this.context.showMessage('服务器错误');\n            })\n    }\n\n    recallArticle = (aid) => {\n        Axios.post(`/api/recall/article/${aid}`)\n            .then( res => {\n                this.context.showMessage(res.data.message);\n                this.getArticles();\n            })\n            .catch( err => {\n                this.context.showMessage('服务器错误');\n            })\n    }\n\n    exportModalCancle = () => {\n        this.setState({\n            isCategoryModalShow: false\n        });\n    }\n\n    onRadioChange = e => {\n        this.setState({\n            category: e.target.value\n        })\n    }\n\n    showArticles() {\n        const { articles } = this.state;\n        const bodyStyle = { padding: '15px' };\n\n        return articles.length ? articles.map( article => {\n                return  <Col span={8} key={article.id} >\n                    <Card title={article.title} hoverable  extra={<Icon type=\"delete\" className=\"article-delete\" onClick={ e => this.deleteArticle(article) } />} bodyStyle={bodyStyle} >\n                        <div className=\"article-content\">\n                            {article.abstract || article.content.substr(0, 100)}\n                        </div>\n                        <div className=\"article-footer clearfix\">\n                            <span>{ this.getTimeString(article.createTime) }</span>\n                            <ButtonGroup className=\"fr\">\n                              <Button ghost type=\"primary\" size=\"small\" onClick={ e => { this.exportOrRecallArticle(article) } } >\n                                {article.publish ? <span><Icon type=\"rollback\" />撤回</span> : <span><Icon type=\"export\" />发布</span>}\n                              </Button>\n                              <Button ghost type=\"primary\" size=\"small\" onClick={ () => { this.goEdit(article) } } >\n                               编辑<Icon type=\"edit\" />\n                              </Button>\n                            </ButtonGroup>\n                        </div>\n                    </Card>\n                </Col>\n            }) : null;\n    }\n\n    render() {\n        const { articles, page, allNum, pageSize, isCategoryModalShow, articleToExport, category } = this.state;\n        return(\n            <Layout className=\"article-manage-layout\">\n                <Header className='article-manage-header clearfix' >\n                    <h2>文章管理</h2><Link to=\"/edit\" className='fr'><Button icon=\"plus\" >写文章</Button></Link>\n                </Header>\n                <Content className=\"article-manage-content\">\n                    <Masonry className=\"article-list\">\n                        { articles.length ? this.showArticles() : <Spin tip=\"Loading...\" size='large' wrapperClassName='loading'>\n                            <Alert\n                              description=\"文章列表加载中...\"\n                              type=\"info\"\n                            />\n                          </Spin> }\n                    </Masonry>\n                </Content>\n                { articles.length ? <Footer><Pagination className='article-pn' showQuickJumper current={ page }  total={allNum} onChange={ this.changePage } pageSize={pageSize} /></Footer> : null}\n                <Modal\n                    title=\"选择发布板块\"\n                    visible={isCategoryModalShow}\n                    onOk={this.exportModalOk}\n                    mask={ false }\n                    onCancel={this.exportModalCancle}>\n                    <RadioGroup onChange={this.onRadioChange} value={ category }>\n                        <Radio value='DEFAULT'>首页</Radio>\n                        <Radio value='TRAVEL' >游记</Radio>\n                    </RadioGroup>\n                </Modal>\n            </Layout>\n        )\n    }\n}"]}]}