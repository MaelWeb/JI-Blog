{"remainingRequest":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js?{\"presets\":[\"react-hmre\"]}!/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Comments/index.js","dependencies":[{"path":"/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Comments/index.js","mtime":1517559361927},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _stringify = require('babel-runtime/core-js/json/stringify');\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _message2 = require('antd/lib/message');\n\nvar _message3 = _interopRequireDefault(_message2);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _index = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/redbox-react/lib/index.js');\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _index3 = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/react-transform-catch-errors/lib/index.js');\n\nvar _index4 = _interopRequireDefault(_index3);\n\nvar _react2 = require('react');\n\nvar _react3 = _interopRequireDefault(_react2);\n\nvar _index5 = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/react-transform-hmr/lib/index.js');\n\nvar _index6 = _interopRequireDefault(_index5);\n\nvar _class, _temp;\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _moment = require('moment');\n\nvar _moment2 = _interopRequireDefault(_moment);\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _Icon = require('../../../components/Icon');\n\nvar _Icon2 = _interopRequireDefault(_Icon);\n\nvar _Emoji = require('../../../components/Emoji');\n\nvar _Emoji2 = _interopRequireDefault(_Emoji);\n\nvar _CommentInput = require('../../../components/CommentInput');\n\nvar _CommentInput2 = _interopRequireDefault(_CommentInput);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _components = {\n    Comments: {\n        displayName: 'Comments'\n    }\n};\n\nvar _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformHmrLibIndexJs2 = (0, _index6.default)({\n    filename: '/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Comments/index.js',\n    components: _components,\n    locals: [module],\n    imports: [_react3.default]\n});\n\nvar _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformCatchErrorsLibIndexJs2 = (0, _index4.default)({\n    filename: '/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Comments/index.js',\n    components: _components,\n    locals: [],\n    imports: [_react3.default, _index2.default]\n});\n\nfunction _wrapComponent(id) {\n    return function (Component) {\n        return _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformHmrLibIndexJs2(_UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformCatchErrorsLibIndexJs2(Component, id), id);\n    };\n}\n\nvar emojiStyle = {\n    height: 20\n};\n\n_moment2.default.locale('zh-cn');\n\nvar Comments = _wrapComponent('Comments')((_temp = _class = function (_Component) {\n    (0, _inherits3.default)(Comments, _Component);\n\n    function Comments(props) {\n        (0, _classCallCheck3.default)(this, Comments);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (Comments.__proto__ || (0, _getPrototypeOf2.default)(Comments)).call(this, props));\n\n        _this.preventDefault = function (e) {\n            e.preventDefault();\n        };\n\n        _this.exportComment = function (commentCont) {\n            var reply = _this.state.reply;\n\n            var user = /access\\_token/g.test(document.cookie) ? {\n                name: '记小栈',\n                email: 'mael.liang@live.com',\n                site: 'https://www.liayal.com',\n                avatar: 'https://cdn.liayal.com/image/logo_min.png'\n            } : window.localStorage.getItem('_liayal_user');\n\n            if (user && commentCont) {\n                _this.saveComment({\n                    user: typeof user == 'string' ? JSON.parse(user) : user,\n                    reply: reply ? reply.id : null,\n                    commentCont: commentCont\n                });\n            } else if (commentCont) {\n                _this.setState({\n                    showUserInfo: true,\n                    commentCont: commentCont\n                });\n            }\n        };\n\n        _this.commentSubmit = function () {\n            var name = _this.refs.userName.value,\n                email = _this.refs.userEamil.value,\n                site = _this.refs.userSite.value,\n                emailReg = /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$/g;\n            var _this$state = _this.state,\n                reply = _this$state.reply,\n                commentCont = _this$state.commentCont;\n\n\n            if (!email || !name) return _message3.default.info('填一下昵称和邮箱呗！');\n\n            if (!emailReg.test(email)) return _message3.default.info('邮箱格式不正确呀！');\n\n            window.localStorage.setItem('_liayal_user', (0, _stringify2.default)({ name: name, email: email, site: site }));\n\n            _this.saveComment({\n                user: { name: name, email: email, site: site },\n                reply: reply ? reply.id : null,\n                commentCont: commentCont\n            });\n        };\n\n        _this.commentCancle = function () {\n            _this.setState({\n                showUserInfo: false\n            });\n        };\n\n        _this.showReplyModal = function (comment) {\n            _this.setState({\n                isShowReplyModal: true,\n                reply: comment\n            });\n        };\n\n        _this.closeReplyModal = function () {\n            _this.setState({\n                isShowReplyModal: false\n            });\n        };\n\n        _this.getTimeString = function (date) {\n            var now = new Date(),\n                nowDate = now.getDate(),\n                createTime = new Date(date),\n                createDate = createTime.getDate(),\n                diff = now.getTime() - date;\n            // 1分钟内\n            if (diff < 1000 * 60) {\n                return '刚刚';\n            } else if (diff < 1000 * 60 * 60) {\n                // 1小时内\n                return Math.ceil(diff / (1000 * 60)) + '\\u5206\\u949F\\u524D';\n            } else if (diff < 1000 * 60 * 60 * 24 && nowDate == createDate) {\n                // 当天内\n                return '\\u4ECA\\u5929 ' + (0, _moment2.default)(date).format('HH:mm');\n            } else if (now.getYear() == createTime.getYear()) {\n                return (0, _moment2.default)(date).format('MM-DD HH:mm');\n            } else {\n                return (0, _moment2.default)(date).format('lll');\n            }\n        };\n\n        _this.state = {\n            showUserInfo: false,\n            isShowReplyModal: false,\n            reply: null,\n            comments: props.comments,\n            commentCont: null\n        };\n\n        _this.caretIndex = 0;\n        return _this;\n    }\n\n    (0, _createClass3.default)(Comments, [{\n        key: 'componentWillReceiveProps',\n        value: function componentWillReceiveProps(nextProps) {\n            this.setState({\n                comments: nextProps.comments\n            });\n        }\n    }, {\n        key: 'saveComment',\n        value: function saveComment(data) {\n            var _this2 = this;\n\n            var articleid = this.props.articleid;\n\n            var comments = this.state.comments;\n            _axios2.default.post('/api/create/comment', (0, _extends3.default)({}, data, { articleid: articleid })).then(function (res) {\n                var resdata = res.data;\n                if (resdata.code == 200) {\n                    comments.unshift(resdata.comment);\n                    data.reply ? _this2.refs.replyInput.clearTextarea() : _this2.refs.commentInput.clearTextarea();\n                    _this2.setState({\n                        showUserInfo: false,\n                        isShowReplyModal: false,\n                        reply: null,\n                        comments: comments,\n                        commentCont: null\n                    });\n                } else {\n                    _message3.default.warning(resdata.message);\n                }\n            }).catch(function (err) {\n                _message3.default.warning('发布失败');\n            });\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _this3 = this;\n\n            var _state = this.state,\n                showUserInfo = _state.showUserInfo,\n                isShowReplyModal = _state.isShowReplyModal,\n                reply = _state.reply,\n                comments = _state.comments;\n\n            return _react3.default.createElement(\n                'article',\n                { className: 'blog-comment' },\n                _react3.default.createElement(_CommentInput2.default, { exportComment: this.exportComment, ref: 'commentInput' }),\n                _react3.default.createElement(\n                    'div',\n                    { className: 'comment-list' },\n                    comments.length ? comments.map(function (comment, index) {\n                        return _react3.default.createElement(\n                            'div',\n                            { className: 'comment-item clearfix border-b', key: index },\n                            _react3.default.createElement(\n                                'div',\n                                { className: 'comment-avatar fl' },\n                                comment.user && comment.user.avatar ? _react3.default.createElement('img', { src: comment.user.avatar, alt: '', className: 'avatar' }) : _react3.default.createElement(_Icon2.default, { type: 'avatar' })\n                            ),\n                            _react3.default.createElement(\n                                'div',\n                                { className: 'comment-body fl' },\n                                _react3.default.createElement(\n                                    'h6',\n                                    null,\n                                    comment.user.name,\n                                    _react3.default.createElement(\n                                        'small',\n                                        null,\n                                        _this3.getTimeString(comment.createTime)\n                                    )\n                                ),\n                                comment.reply ? _react3.default.createElement(\n                                    _Emoji2.default,\n                                    { style: emojiStyle },\n                                    _react3.default.createElement(\n                                        'blockquote',\n                                        null,\n                                        '@',\n                                        comment.reply.user.name,\n                                        ': ',\n                                        comment.reply.commentCont\n                                    )\n                                ) : null,\n                                _react3.default.createElement(\n                                    _Emoji2.default,\n                                    { style: emojiStyle },\n                                    _react3.default.createElement(\n                                        'p',\n                                        null,\n                                        comment.commentCont\n                                    )\n                                ),\n                                _react3.default.createElement(\n                                    'div',\n                                    { className: 'comment-reply' },\n                                    _react3.default.createElement(_Icon2.default, { type: 'reply', onClick: function onClick(e) {\n                                            _this3.showReplyModal(comment);\n                                        } })\n                                )\n                            )\n                        );\n                    }) : null\n                ),\n                _react3.default.createElement(\n                    'div',\n                    { className: 'comment-modal', hidden: !showUserInfo, style: { zIndex: 5 }, ref: 'UserModal' },\n                    _react3.default.createElement(\n                        'div',\n                        { className: 'comment-user-modal-form' },\n                        _react3.default.createElement('img', { src: '//cdn.liayal.com/image/logo.png', alt: '' }),\n                        _react3.default.createElement('input', { type: 'text', name: 'name', placeholder: '\\u6635\\u79F0(\\u5FC5\\u586B)', ref: 'userName' }),\n                        _react3.default.createElement('input', { type: 'text', name: 'email', placeholder: 'xxxx@qq.com(\\u5FC5\\u586B)', ref: 'userEamil' }),\n                        _react3.default.createElement('input', { type: 'text', name: 'site', placeholder: 'www.yourblog.com', ref: 'userSite' }),\n                        _react3.default.createElement(\n                            'div',\n                            { className: 'btns' },\n                            _react3.default.createElement(\n                                'button',\n                                { onClick: this.commentCancle },\n                                '\\u53D6\\u6D88'\n                            ),\n                            _react3.default.createElement(\n                                'button',\n                                { onClick: this.commentSubmit },\n                                '\\u786E\\u8BA4'\n                            )\n                        )\n                    )\n                ),\n                _react3.default.createElement(\n                    'div',\n                    { className: 'comment-modal', hidden: !isShowReplyModal, ref: 'ReplyModal' },\n                    _react3.default.createElement(\n                        'div',\n                        { className: 'comment-reply-from' },\n                        _react3.default.createElement(\n                            'h6',\n                            { className: 'tl' },\n                            '\\u56DE\\u590D\\uFF1A',\n                            reply && reply.user.name,\n                            ' ',\n                            _react3.default.createElement(_Icon2.default, { type: 'close-x comment-close', onClick: this.closeReplyModal })\n                        ),\n                        _react3.default.createElement(_CommentInput2.default, { exportComment: this.exportComment, ref: 'replyInput' })\n                    )\n                )\n            );\n        }\n    }]);\n    return Comments;\n}(_react2.Component), _class.defaultProps = {\n    articleid: '',\n    comments: []\n}, _class.defaultPropTypes = {\n    comments: _propTypes2.default.array\n}, _temp));\n\nexports.default = Comments;",{"version":3,"sources":["web/page/blog/Comments/index.js"],"names":["emojiStyle","height","locale","props","preventDefault","e","exportComment","reply","state","user","test","document","cookie","name","email","site","avatar","window","localStorage","getItem","commentCont","saveComment","JSON","parse","id","setState","showUserInfo","commentSubmit","refs","userName","value","userEamil","userSite","emailReg","info","setItem","commentCancle","showReplyModal","comment","isShowReplyModal","closeReplyModal","getTimeString","date","now","Date","nowDate","getDate","createTime","createDate","diff","getTime","Math","ceil","format","getYear","comments","caretIndex","nextProps","data","articleid","post","then","resdata","res","code","unshift","replyInput","clearTextarea","commentInput","warning","message","catch","length","map","index","zIndex","defaultProps","defaultPropTypes","array"],"mappings":"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","file":"index.js","sourceRoot":"/Users/mael.liang/Workspace/node-koa-test","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Moment from 'moment';\nimport ClassNames from 'classnames';\nimport Icon from '../../../components/Icon';\nimport Emojify from '../../../components/Emoji';\nimport CommentInput from '../../../components/CommentInput';\nimport Axios from 'axios';\nimport { message } from 'antd';\n\nconst emojiStyle = {\n    height: 20\n};\n\nMoment.locale('zh-cn');\n\nexport default class Comments extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            showUserInfo: false,\n            isShowReplyModal: false,\n            reply: null,\n            comments: props.comments,\n            commentCont: null\n        };\n\n        this.caretIndex = 0;\n    }\n\n    static defaultProps = {\n        articleid: '',\n        comments: []\n    };\n\n    static defaultPropTypes = {\n        comments: PropTypes.array\n    };\n\n    componentWillReceiveProps(nextProps) {\n        this.setState({\n            comments: nextProps.comments\n        });\n    }\n\n    preventDefault = (e) => {\n         e.preventDefault();\n    }\n\n    exportComment = commentCont => {\n        const { reply } = this.state;\n        const user = /access\\_token/g.test(document.cookie) ? {\n            name: '记小栈',\n            email: 'mael.liang@live.com',\n            site: 'https://www.liayal.com',\n            avatar: 'https://cdn.liayal.com/image/logo_min.png'\n        } : window.localStorage.getItem('_liayal_user');\n\n        if (user && commentCont) {\n            this.saveComment({\n                user: (typeof user == 'string') ? JSON.parse(user) : user,\n                reply: reply ? reply.id : null,\n                commentCont\n            });\n        } else if (commentCont) {\n            this.setState({\n                showUserInfo: true,\n                commentCont\n            });\n        }\n    }\n\n    commentSubmit = () => {\n        const name = this.refs.userName.value,\n            email = this.refs.userEamil.value,\n            site = this.refs.userSite.value,\n            emailReg = /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$/g;\n        const { reply, commentCont } = this.state;\n\n        if (!email || !name ) return message.info('填一下昵称和邮箱呗！');\n\n        if (!emailReg.test(email)) return message.info('邮箱格式不正确呀！');\n\n        window.localStorage.setItem('_liayal_user', JSON.stringify({name, email, site}));\n\n        this.saveComment({\n            user: {name, email, site},\n            reply: reply ? reply.id : null,\n            commentCont\n        });\n    }\n\n    commentCancle = () => {\n        this.setState({\n            showUserInfo: false\n        })\n    }\n\n    saveComment(data) {\n        const { articleid } = this.props;\n        let comments = this.state.comments;\n        Axios.post('/api/create/comment', {...data, articleid})\n            .then( res => {\n                let resdata = res.data;\n                if (resdata.code  == 200) {\n                    comments.unshift(resdata.comment);\n                    data.reply ? this.refs.replyInput.clearTextarea() : this.refs.commentInput.clearTextarea();\n                    this.setState({\n                        showUserInfo: false,\n                        isShowReplyModal: false,\n                        reply: null,\n                        comments: comments,\n                        commentCont: null\n                    });\n                } else {\n                    message.warning(resdata.message);\n                }\n            })\n            .catch( err => {\n                message.warning('发布失败');\n            })\n    }\n\n    showReplyModal = (comment) => {\n        this.setState({\n            isShowReplyModal: true,\n            reply: comment\n        })\n    }\n\n    closeReplyModal = () => {\n        this.setState({\n            isShowReplyModal: false\n        })\n    }\n\n    getTimeString = (date) => {\n        let now = new Date(),\n            nowDate = now.getDate(),\n            createTime = new Date(date),\n            createDate = createTime.getDate(),\n            diff = now.getTime() - date;\n        // 1分钟内\n        if (diff < 1000 * 60 ) {\n            return '刚刚';\n        } else if (diff < 1000 * 60 * 60) {\n            // 1小时内\n            return `${Math.ceil(diff / (1000 * 60))}分钟前`;\n        } else if ( (diff < 1000 * 60 * 60 * 24) && (nowDate == createDate) ) {\n            // 当天内\n            return `今天 ${Moment(date).format('HH:mm')}`;\n        } else if (now.getYear() == createTime.getYear() ) {\n            return Moment(date).format('MM-DD HH:mm');\n        } else {\n            return Moment(date).format('lll');\n        }\n    }\n\n    render() {\n        const { showUserInfo, isShowReplyModal, reply, comments } = this.state;\n        return (\n            <article className=\"blog-comment\">\n                <CommentInput exportComment={ this.exportComment } ref='commentInput' />\n\n                <div className=\"comment-list\">\n                    { comments.length ? comments.map((comment, index) => (<div className=\"comment-item clearfix border-b\" key={index} >\n                        <div className=\"comment-avatar fl\">{ comment.user && comment.user.avatar ? <img src={comment.user.avatar} alt=\"\" className=\"avatar\"/> : <Icon type='avatar' />}</div>\n                        <div className=\"comment-body fl\">\n                            <h6>{comment.user.name}<small>{this.getTimeString(comment.createTime)}</small></h6>\n                            { comment.reply ? <Emojify style={emojiStyle}><blockquote>@{comment.reply.user.name}: {comment.reply.commentCont}</blockquote></Emojify> : null}\n                            <Emojify style={emojiStyle} ><p>{comment.commentCont}</p></Emojify>\n                            <div className=\"comment-reply\">\n                                <Icon type='reply' onClick={ e => {this.showReplyModal(comment)} } />\n                            </div>\n                        </div>\n                    </div>)) : null}\n                </div>\n\n                <div className=\"comment-modal\" hidden={!showUserInfo} style={{zIndex: 5}} ref='UserModal'>\n                    <div className=\"comment-user-modal-form\">\n                            <img src=\"//cdn.liayal.com/image/logo.png\" alt=\"\"/>\n                            <input type=\"text\" name=\"name\" placeholder='昵称(必填)' ref='userName' />\n                            <input type=\"text\" name=\"email\" placeholder='xxxx@qq.com(必填)' ref='userEamil' />\n                            <input type=\"text\" name=\"site\" placeholder='www.yourblog.com' ref='userSite' />\n                            <div className=\"btns\">\n                                <button onClick={ this.commentCancle }>取消</button>\n                                <button onClick={ this.commentSubmit } >确认</button>\n                            </div>\n                    </div>\n                </div>\n\n                <div className=\"comment-modal\" hidden={!isShowReplyModal} ref='ReplyModal'>\n                    <div className=\"comment-reply-from\">\n                        <h6 className='tl'>回复：{ reply && reply.user.name} <Icon type='close-x comment-close' onClick={ this.closeReplyModal } /></h6>\n                        <CommentInput exportComment={ this.exportComment } ref='replyInput' />\n                    </div>\n                </div>\n            </article>\n        )\n    }\n}"]}]}