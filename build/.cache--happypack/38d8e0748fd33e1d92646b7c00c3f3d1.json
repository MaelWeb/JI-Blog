{"remainingRequest":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js?{\"presets\":[]}!/Users/mael.liang/Workspace/node-koa-test/web/page/admin/CommentsManage/index.js","dependencies":[{"path":"/Users/mael.liang/Workspace/node-koa-test/web/page/admin/CommentsManage/index.js","mtime":1517558604560},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _pagination = require('antd/lib/pagination');\n\nvar _pagination2 = _interopRequireDefault(_pagination);\n\nvar _col = require('antd/lib/col');\n\nvar _col2 = _interopRequireDefault(_col);\n\nvar _card = require('antd/lib/card');\n\nvar _card2 = _interopRequireDefault(_card);\n\nvar _tooltip = require('antd/lib/tooltip');\n\nvar _tooltip2 = _interopRequireDefault(_tooltip);\n\nvar _icon = require('antd/lib/icon');\n\nvar _icon2 = _interopRequireDefault(_icon);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _modal = require('antd/lib/modal');\n\nvar _modal2 = _interopRequireDefault(_modal);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _button = require('antd/lib/button');\n\nvar _button2 = _interopRequireDefault(_button);\n\nvar _layout = require('antd/lib/layout');\n\nvar _layout2 = _interopRequireDefault(_layout);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactRouterDom = require('react-router-dom');\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _reactMasonryComponent = require('react-masonry-component');\n\nvar _reactMasonryComponent2 = _interopRequireDefault(_reactMasonryComponent);\n\nvar _Emoji = require('Components/Emoji');\n\nvar _Emoji2 = _interopRequireDefault(_Emoji);\n\nvar _CommentInput = require('Components/CommentInput');\n\nvar _CommentInput2 = _interopRequireDefault(_CommentInput);\n\nrequire('Components/CommentInput/index.less');\n\nrequire('./index.less');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Header = _layout2.default.Header,\n    Content = _layout2.default.Content,\n    Footer = _layout2.default.Footer;\n\nvar ButtonGroup = _button2.default.Group;\nvar emojiStyle = {\n    height: 20\n};\n\nvar ComponentsManege = function (_Component) {\n    (0, _inherits3.default)(ComponentsManege, _Component);\n\n    function ComponentsManege(props) {\n        (0, _classCallCheck3.default)(this, ComponentsManege);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (ComponentsManege.__proto__ || (0, _getPrototypeOf2.default)(ComponentsManege)).call(this, props));\n\n        _this.changePage = function (page) {\n            _this.getComments(page);\n        };\n\n        _this.toggleComment = function (comment, index) {\n            _axios2.default.post('/api/toggle/comment', {\n                id: comment.id,\n                isRemove: !comment.isRemove\n            });\n\n            _this.setState(function (preState) {\n                var comments = preState.comments;\n                comments[index].isRemove = !comment.isRemove;\n                return {\n                    comments: comments\n                };\n            });\n        };\n\n        _this.deleteComment = function (comment) {\n            _modal2.default.confirm({\n                title: '确定删除当前评论?',\n                content: '评论删除后不可恢复',\n                okText: '删除',\n                okType: 'danger',\n                cancelText: '取消',\n                onOk: function onOk() {\n                    return _this.doDelete(comment.id);\n                }\n            });\n        };\n\n        _this.repeatComment = function (comment) {\n            _this.setState({\n                isRepeatModalShow: true,\n                respondent: comment\n            });\n        };\n\n        _this.hideRepeat = function () {\n            _this.setState({\n                isRepeatModalShow: false\n            });\n        };\n\n        _this.repeat = function () {\n            var respondent = _this.state.respondent;\n\n            var commentCont = _this.refs.replyInput.textareaDom.value;\n            if (!commentCont) return _this.context.showMessage('请输入回复内容');\n            var data = {\n                articleid: respondent.articleid,\n                commentCont: _this.refs.replyInput.textareaDom.value,\n                reply: respondent.id,\n                user: {\n                    name: '记小栈',\n                    email: 'mael.liang@live.com',\n                    site: 'https://www.liayal.com',\n                    avatar: 'https://cdn.liayal.com/image/logo_min.png'\n                }\n            };\n            _axios2.default.post('/api/create/comment', (0, _extends3.default)({}, data)).then(function (res) {\n                var resdata = res.data;\n                if (resdata.code == 200) {\n                    _this.getComments();\n                    _this.hideRepeat();\n                } else {\n                    _this.context.showMessage(resdata.message);\n                }\n            }).catch(function (err) {\n                _this.context.showMessage('发布失败');\n            });\n        };\n\n        _this.state = {\n            pageSize: 12,\n            comments: [],\n            page: 1,\n            isRepeatModalShow: false,\n            respondent: {}\n        };\n\n        _this.hasLoad = false;\n        return _this;\n    }\n\n    (0, _createClass3.default)(ComponentsManege, [{\n        key: 'componentWillMount',\n        value: function componentWillMount() {\n            this.getComments(1);\n        }\n    }, {\n        key: 'getComments',\n        value: function getComments(_page) {\n            var _this2 = this;\n\n            var _state = this.state,\n                pageSize = _state.pageSize,\n                page = _state.page;\n\n            _axios2.default.get('/api/get/comments', {\n                params: {\n                    page: _page || page,\n                    size: pageSize\n                }\n            }).then(function (res) {\n                _this2.hasLoad = true;\n                _this2.setState({\n                    comments: res.data.comments || [],\n                    allNum: res.data.allNum,\n                    page: res.data.page\n                });\n            });\n        }\n    }, {\n        key: 'doDelete',\n        value: function doDelete(id) {\n            var _this3 = this;\n\n            return _axios2.default.delete('/api/comment/' + id).then(function (res) {\n                if (res.data.code) {\n                    _this3.context.showMessage(res.data.message);\n                    _this3.getComments();\n                }\n            }).catch(function (err) {\n                _this3.context.showMessage(err);\n            });\n        }\n    }, {\n        key: 'showComments',\n        value: function showComments() {\n            var _this4 = this;\n\n            var comments = this.state.comments;\n\n            var bodyStyle = { padding: '15px' };\n\n            return comments.length ? comments.map(function (comment, index) {\n                return _react2.default.createElement(\n                    _col2.default,\n                    { span: 8, key: comment.id },\n                    _react2.default.createElement(\n                        _card2.default,\n                        { title: _react2.default.createElement(\n                                'span',\n                                null,\n                                _react2.default.createElement(_icon2.default, { type: 'user' }),\n                                ' ',\n                                comment.user.name\n                            ), extra: _react2.default.createElement(_icon2.default, { type: 'delete', className: 'comment-delete', onClick: function onClick(e) {\n                                    return _this4.deleteComment(comment);\n                                } }), bodyStyle: bodyStyle },\n                        _react2.default.createElement(\n                            _tooltip2.default,\n                            { placement: 'topLeft', title: '\\u70B9\\u51FB\\u5185\\u5BB9\\u53BB\\u5BF9\\u5E94\\u6587\\u7AE0' },\n                            _react2.default.createElement(\n                                'div',\n                                { className: 'comment-content' },\n                                _react2.default.createElement(\n                                    'a',\n                                    { href: comment.articleid ? window.location.origin + '/article/' + comment.articleid : 'javascript:void(0);', className: '' },\n                                    _react2.default.createElement(\n                                        _Emoji2.default,\n                                        { style: emojiStyle },\n                                        comment.commentCont\n                                    )\n                                )\n                            )\n                        ),\n                        _react2.default.createElement(\n                            'div',\n                            { className: 'comment-footer clearfix' },\n                            _react2.default.createElement(_icon2.default, { type: 'mail' }),\n                            _react2.default.createElement(\n                                'span',\n                                null,\n                                comment.user.email\n                            ),\n                            _react2.default.createElement(\n                                ButtonGroup,\n                                { className: 'fr' },\n                                _react2.default.createElement(\n                                    _button2.default,\n                                    { ghost: true, type: 'primary', size: 'small', onClick: function onClick(e) {\n                                            _this4.repeatComment(comment);\n                                        } },\n                                    _react2.default.createElement(_icon2.default, { type: 'message' }),\n                                    '\\u56DE\\u590D'\n                                ),\n                                _react2.default.createElement(\n                                    _button2.default,\n                                    { ghost: true, type: 'primary', size: 'small', onClick: function onClick(e) {\n                                            _this4.toggleComment(comment, index);\n                                        } },\n                                    comment.isRemove ? _react2.default.createElement(\n                                        'span',\n                                        null,\n                                        _react2.default.createElement(_icon2.default, { type: 'eye' }),\n                                        '\\u663E\\u793A'\n                                    ) : _react2.default.createElement(\n                                        'span',\n                                        null,\n                                        _react2.default.createElement(_icon2.default, { type: 'eye-o' }),\n                                        '\\u9690\\u85CF'\n                                    )\n                                )\n                            )\n                        )\n                    )\n                );\n            }) : null;\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _state2 = this.state,\n                comments = _state2.comments,\n                page = _state2.page,\n                allNum = _state2.allNum,\n                pageSize = _state2.pageSize,\n                isRepeatModalShow = _state2.isRepeatModalShow,\n                respondent = _state2.respondent;\n\n            return _react2.default.createElement(\n                _layout2.default,\n                { className: 'comments-manage-layout' },\n                _react2.default.createElement(\n                    Header,\n                    { className: 'comments-manage-header clearfix' },\n                    _react2.default.createElement(\n                        'h2',\n                        null,\n                        '\\u8BC4\\u8BBA\\u7BA1\\u7406'\n                    )\n                ),\n                _react2.default.createElement(\n                    Content,\n                    { className: 'comments-manage-content' },\n                    comments.length ? _react2.default.createElement(\n                        _reactMasonryComponent2.default,\n                        { className: 'comments-list' },\n                        this.showComments()\n                    ) : _react2.default.createElement(\n                        'p',\n                        { className: 'tc', style: { fontSize: '.2rem', padding: '.4rem 0' } },\n                        '~~ \\u6682\\u65E0\\u8BC4\\u8BBA ~~'\n                    )\n                ),\n                comments.length ? _react2.default.createElement(\n                    Footer,\n                    null,\n                    _react2.default.createElement(_pagination2.default, { className: 'tc', showQuickJumper: true, current: page, total: allNum, onChange: this.changePage, pageSize: pageSize })\n                ) : null,\n                _react2.default.createElement(\n                    _modal2.default,\n                    {\n                        title: '\\u56DE\\u590D\\uFF1A' + (respondent.user && respondent.user.name),\n                        visible: isRepeatModalShow,\n                        onOk: this.repeat,\n                        onCancel: this.hideRepeat,\n                        okText: '\\u786E\\u5B9A',\n                        cancelText: '\\u53D6\\u6D88',\n                        mask: false },\n                    _react2.default.createElement(_CommentInput2.default, { isShowBtn: false, ref: 'replyInput' })\n                )\n            );\n        }\n    }]);\n    return ComponentsManege;\n}(_react.Component);\n\nComponentsManege.contextTypes = {\n    showMessage: _propTypes2.default.func\n};\nexports.default = ComponentsManege;",null]}