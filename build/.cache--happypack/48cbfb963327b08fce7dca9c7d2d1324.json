{"remainingRequest":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js?{\"presets\":[]}!/Users/mael.liang/Workspace/node-koa-test/web/page/admin/BooksManage/index.js","dependencies":[{"path":"/Users/mael.liang/Workspace/node-koa-test/web/page/admin/BooksManage/index.js","mtime":1515141180591},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _pagination = require('antd/lib/pagination');\n\nvar _pagination2 = _interopRequireDefault(_pagination);\n\nvar _upload = require('antd/lib/upload');\n\nvar _upload2 = _interopRequireDefault(_upload);\n\nvar _button = require('antd/lib/button');\n\nvar _button2 = _interopRequireDefault(_button);\n\nvar _switch = require('antd/lib/switch');\n\nvar _switch2 = _interopRequireDefault(_switch);\n\nvar _icon = require('antd/lib/icon');\n\nvar _icon2 = _interopRequireDefault(_icon);\n\nvar _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');\n\nvar _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);\n\nvar _message2 = require('antd/lib/message');\n\nvar _message3 = _interopRequireDefault(_message2);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _input = require('antd/lib/input');\n\nvar _input2 = _interopRequireDefault(_input);\n\nvar _layout = require('antd/lib/layout');\n\nvar _layout2 = _interopRequireDefault(_layout);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactRouterDom = require('react-router-dom');\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _config = require('../../../config/');\n\nrequire('./index.less');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Header = _layout2.default.Header,\n    Content = _layout2.default.Content,\n    Footer = _layout2.default.Footer;\nvar TextArea = _input2.default.TextArea;\n\nvar BooksManage = function (_Component) {\n    (0, _inherits3.default)(BooksManage, _Component);\n\n    function BooksManage(props) {\n        (0, _classCallCheck3.default)(this, BooksManage);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (BooksManage.__proto__ || (0, _getPrototypeOf2.default)(BooksManage)).call(this, props));\n\n        _this.uploadereChange = function (info) {\n            if (info.file.status === 'done') {\n                _message3.default.success(\"上传成功\");\n                var response = info.file.response;\n\n                _this.setState({\n                    imageUpUrl: '' + _config.IMG_URL + response.data.key,\n                    imageUrl: '' + _config.IMG_URL + response.data.key\n                });\n            }\n        };\n\n        _this.imgInputChange = function (e) {\n            _this.setState({\n                imageUrl: e.target.value\n            });\n        };\n\n        _this.textChange = function (e) {\n            _this.setState({\n                desc: e.target.value\n            });\n        };\n\n        _this.hrefChange = function (e) {\n            _this.setState({\n                href: e.target.value\n            });\n        };\n\n        _this.titleChange = function (e) {\n            _this.setState({\n                title: e.target.value\n            });\n        };\n\n        _this.authorChange = function (e) {\n            _this.setState({\n                author: e.target.value\n            });\n        };\n\n        _this.addBook = function (e) {\n            var _this$state = _this.state,\n                imageUrl = _this$state.imageUrl,\n                desc = _this$state.desc,\n                href = _this$state.href,\n                title = _this$state.title,\n                author = _this$state.author;\n\n\n            if (!title) return _message3.default.success(\"请添加书名\");\n            if (!author) return _message3.default.success(\"请添加作者\");\n            if (!desc) return _message3.default.success(\"请添加导言\");\n            if (!imageUrl) return _message3.default.success(\"请添加封面\");\n\n            _axios2.default.post('/api/create/book', { img: imageUrl, desc: desc, href: href, title: title, author: author }).then(function (res) {\n                if (res.data.code == 200) {\n                    _message3.default.success(\"添加成功\");\n                    _this.getBooks();\n                } else {\n                    _message3.default.error(\"添加失败\");\n                }\n            });\n        };\n\n        _this.bookUploaderChange = function (info, index) {\n            if (info.file.status === 'done') {\n                _message3.default.success(\"上传成功\");\n                var response = info.file.response;\n\n                _this.setState(function (preState) {\n                    preState.books[index].img = '' + _config.IMG_URL + response.data.key;\n\n                    return { books: preState.books };\n                });\n            }\n        };\n\n        _this.bookImgInputChange = function (e, index) {\n            var value = e.target.value;\n            _this.setState(function (preState) {\n                preState.books[index].img = value;\n\n                return { books: preState.books };\n            });\n        };\n\n        _this.bookTextChange = function (e, index) {\n            var value = e.target.value;\n            _this.setState(function (preState) {\n                preState.books[index].text = value;\n\n                return { books: preState.books };\n            });\n        };\n\n        _this.bookHrefChange = function (e, index) {\n            var value = e.target.value;\n            _this.setState(function (preState) {\n                preState.books[index].href = value;\n\n                return { books: preState.books };\n            });\n        };\n\n        _this.bookTitleChange = function (e, index) {\n            var value = e.target.value;\n            _this.setState(function (preState) {\n                preState.books[index].title = value;\n\n                return { books: preState.books };\n            });\n        };\n\n        _this.bookAuthorChange = function (e, index) {\n            var value = e.target.value;\n            _this.setState(function (preState) {\n                preState.books[index].author = value;\n\n                return { books: preState.books };\n            });\n        };\n\n        _this.updateBook = function (book) {\n            var id = book.id,\n                others = (0, _objectWithoutProperties3.default)(book, ['id']);\n\n            _axios2.default.post('/api/update/book/' + id, others).then(function (res) {\n                _message3.default.success(res.data.message);\n            });\n        };\n\n        _this.delete = function (book) {\n            var key = book.img.split(_config.IMG_URL)[1];\n            _this.deleteBookPic(key);\n            _this.deleteBook(book.id);\n        };\n\n        _this.changeReadingStatus = function (checked, index) {\n            _this.setState(function (preState) {\n                preState.books[index].isReading = checked;\n\n                return { books: preState.books };\n            });\n        };\n\n        _this.changePage = function (page) {\n            _this.getBooks(page);\n        };\n\n        _this.state = {\n            imageUrl: '',\n            imageUpUrl: '',\n            desc: '',\n            href: '',\n            title: '',\n            author: '',\n            allPage: 0,\n            allNum: 0,\n            page: 1,\n            pageSize: 10,\n            books: []\n        };\n\n        return _this;\n    }\n\n    (0, _createClass3.default)(BooksManage, [{\n        key: 'componentWillMount',\n        value: function componentWillMount() {\n            this.getBooks();\n        }\n    }, {\n        key: 'getBooks',\n        value: function getBooks(_page) {\n            var _this2 = this;\n\n            var _state = this.state,\n                pageSize = _state.pageSize,\n                page = _state.page;\n\n            _axios2.default.get(\"/api/get/books\", {\n                params: {\n                    page: _page || page,\n                    size: pageSize\n                }\n            }).then(function (res) {\n                _this2.setState({\n                    books: res.data.books,\n                    page: res.data.page,\n                    allPage: res.data.allPage,\n                    allNum: res.data.allNum\n                });\n            });\n        }\n    }, {\n        key: 'deleteBook',\n        value: function deleteBook(id) {\n            var _this3 = this;\n\n            _axios2.default.delete('/api/book/' + id).then(function (res) {\n                _message3.default.success(res.data.message);\n                if (res.data.code == 200) {\n                    _this3.getBooks();\n                }\n            });\n        }\n    }, {\n        key: 'deleteBookPic',\n        value: function deleteBookPic(key) {\n            return _axios2.default.post(\"/api/filedelete\", {\n                key: key\n            });\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _this4 = this;\n\n            var _state2 = this.state,\n                imageUrl = _state2.imageUrl,\n                imageUpUrl = _state2.imageUpUrl,\n                desc = _state2.desc,\n                href = _state2.href,\n                books = _state2.books,\n                title = _state2.title,\n                author = _state2.author,\n                allPage = _state2.allPage,\n                allNum = _state2.allNum,\n                page = _state2.page,\n                pageSize = _state2.pageSize;\n\n            return _react2.default.createElement(\n                _layout2.default,\n                { className: 'books-manage-layout' },\n                _react2.default.createElement(\n                    Header,\n                    { className: 'books-manage-header clearfix' },\n                    _react2.default.createElement(\n                        'h2',\n                        null,\n                        '\\u56FE\\u4E66\\u7BA1\\u7406'\n                    )\n                ),\n                _react2.default.createElement(\n                    Content,\n                    { className: 'books-manage-content' },\n                    books.length ? books.map(function (book, index) {\n                        return _react2.default.createElement(\n                            'div',\n                            { className: 'book-box', key: book.id },\n                            _react2.default.createElement(\n                                'div',\n                                { className: 'books-wrap' },\n                                _react2.default.createElement(\n                                    'div',\n                                    { className: 'book-img' },\n                                    book.img ? _react2.default.createElement('img', { src: book.img, alt: '' }) : _react2.default.createElement(_icon2.default, { type: 'picture' }),\n                                    _react2.default.createElement(_switch2.default, { checkedChildren: '\\u5728\\u8BFB', unCheckedChildren: '\\u8BFB\\u5B8C', defaultChecked: book.isReading, onChange: function onChange(checked) {\n                                            _this4.changeReadingStatus(checked, index);\n                                        } })\n                                ),\n                                _react2.default.createElement(\n                                    'div',\n                                    { className: 'book-info' },\n                                    _react2.default.createElement(\n                                        'label',\n                                        { htmlFor: '' },\n                                        _react2.default.createElement(_input2.default, { className: 'title', placeholder: '\\u4E66\\u540D', value: book.title, onChange: function onChange(e) {\n                                                _this4.bookTitleChange(e, index);\n                                            } })\n                                    ),\n                                    _react2.default.createElement(\n                                        'label',\n                                        { htmlFor: '' },\n                                        _react2.default.createElement(_input2.default, { className: 'author', placeholder: '\\u4F5C\\u8005', value: book.author, onChange: function onChange(e) {\n                                                _this4.bookAuthorChange(e, index);\n                                            } })\n                                    ),\n                                    _react2.default.createElement(\n                                        'label',\n                                        { htmlFor: '' },\n                                        _react2.default.createElement(TextArea, { className: 'info', placeholder: '\\u5BFC\\u8A00', row: '4', value: book.desc, onChange: function onChange(e) {\n                                                _this4.bookTextChange(e, index);\n                                            } })\n                                    ),\n                                    _react2.default.createElement(\n                                        'label',\n                                        { htmlFor: '' },\n                                        _react2.default.createElement(_input2.default, { placeholder: '\\u8BD5\\u8BFB\\u94FE\\u63A5', value: book.href, onChange: function onChange(e) {\n                                                _this4.bookHrefChange(e, index);\n                                            } })\n                                    ),\n                                    _react2.default.createElement(\n                                        'label',\n                                        { htmlFor: '' },\n                                        _react2.default.createElement(_input2.default, { placeholder: '\\u8BF7\\u8F93\\u5165\\u5C01\\u9762\\u5730\\u5740\\u6216\\u624B\\u52A8\\u4E0A\\u4F20', value: book.img, onChange: function onChange(e) {\n                                                _this4.bookImgInputChange(e, index);\n                                            } }),\n                                        _react2.default.createElement(\n                                            _upload2.default,\n                                            {\n                                                className: 'uploader',\n                                                accept: 'image/*',\n                                                action: '/api/fileupload',\n                                                data: { prefix: 'book/' },\n                                                showUploadList: false,\n                                                onChange: function onChange(info) {\n                                                    _this4.bookUploaderChange(info, index);\n                                                } },\n                                            _react2.default.createElement(\n                                                _button2.default,\n                                                null,\n                                                _react2.default.createElement(_icon2.default, { type: 'upload' }),\n                                                '\\u70B9\\u51FB\\u4E0A\\u4F20'\n                                            )\n                                        )\n                                    ),\n                                    _react2.default.createElement(\n                                        'div',\n                                        { className: 'btn' },\n                                        _react2.default.createElement(\n                                            _button2.default,\n                                            { onClick: function onClick() {\n                                                    _this4.updateBook(book);\n                                                } },\n                                            '\\u4FDD\\u5B58'\n                                        ),\n                                        _react2.default.createElement(\n                                            _button2.default,\n                                            { onClick: function onClick() {\n                                                    _this4.delete(book);\n                                                } },\n                                            '\\u5220\\u9664'\n                                        )\n                                    )\n                                )\n                            )\n                        );\n                    }) : null,\n                    _react2.default.createElement(\n                        'div',\n                        { className: 'book-box add-box' },\n                        _react2.default.createElement(\n                            'div',\n                            { className: 'books-wrap' },\n                            _react2.default.createElement(\n                                'div',\n                                { className: 'book-img' },\n                                imageUrl ? _react2.default.createElement('img', { src: imageUrl, alt: '' }) : _react2.default.createElement(_icon2.default, { type: 'picture' })\n                            ),\n                            _react2.default.createElement(\n                                'div',\n                                { className: 'book-info' },\n                                _react2.default.createElement(\n                                    'label',\n                                    { htmlFor: '' },\n                                    _react2.default.createElement(_input2.default, { className: 'title', placeholder: '\\u4E66\\u540D', value: title, onChange: this.titleChange })\n                                ),\n                                _react2.default.createElement(\n                                    'label',\n                                    { htmlFor: '' },\n                                    _react2.default.createElement(_input2.default, { className: 'author', placeholder: '\\u4F5C\\u8005', value: author, onChange: this.authorChange })\n                                ),\n                                _react2.default.createElement(\n                                    'label',\n                                    { htmlFor: '' },\n                                    _react2.default.createElement(TextArea, { className: 'info', placeholder: '\\u5BFC\\u8A00', value: desc, onChange: this.textChange, autosize: { minRows: 2, maxRows: 6 } })\n                                ),\n                                _react2.default.createElement(\n                                    'label',\n                                    { htmlFor: '' },\n                                    _react2.default.createElement(_input2.default, { placeholder: '\\u8BF7\\u8F93\\u5165\\u5C01\\u9762\\u5730\\u5740\\u6216\\u624B\\u52A8\\u4E0A\\u4F20', value: imageUrl, onChange: this.imgInputChange }),\n                                    _react2.default.createElement(\n                                        _upload2.default,\n                                        {\n                                            className: 'uploader',\n                                            accept: 'image/*',\n                                            action: '/api/fileupload',\n                                            data: { prefix: 'books/' },\n                                            showUploadList: false,\n                                            onChange: this.uploadereChange },\n                                        _react2.default.createElement(\n                                            _button2.default,\n                                            null,\n                                            _react2.default.createElement(_icon2.default, { type: 'upload' }),\n                                            '\\u70B9\\u51FB\\u4E0A\\u4F20'\n                                        )\n                                    )\n                                ),\n                                _react2.default.createElement(\n                                    'label',\n                                    { htmlFor: '' },\n                                    _react2.default.createElement(_input2.default, { placeholder: '\\u8BD5\\u8BFB\\u94FE\\u63A5', value: href, onChange: this.hrefChange })\n                                ),\n                                _react2.default.createElement(\n                                    'div',\n                                    { className: 'btn' },\n                                    _react2.default.createElement(\n                                        _button2.default,\n                                        { onClick: this.addBook },\n                                        '\\u6DFB\\u52A0'\n                                    )\n                                )\n                            )\n                        )\n                    )\n                ),\n                allPage > 1 ? _react2.default.createElement(\n                    Footer,\n                    null,\n                    _react2.default.createElement(_pagination2.default, { className: 'tc', showQuickJumper: true, current: page, total: allNum, onChange: this.changePage, pageSize: pageSize })\n                ) : null\n            );\n        }\n    }]);\n    return BooksManage;\n}(_react.Component);\n\nBooksManage.contextTypes = {\n    showMessage: _propTypes2.default.func\n};\nexports.default = BooksManage;",null]}