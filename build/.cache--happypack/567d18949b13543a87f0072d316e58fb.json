{"remainingRequest":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js?{\"presets\":[]}!/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Photoes/index.js","dependencies":[{"path":"/Users/mael.liang/Workspace/node-koa-test/web/page/blog/Photoes/index.js","mtime":1515732465145},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactDom = require('react-dom');\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _reactPhotoGallery = require('react-photo-gallery');\n\nvar _reactPhotoGallery2 = _interopRequireDefault(_reactPhotoGallery);\n\nvar _reactMeasure = require('react-measure');\n\nvar _reactMeasure2 = _interopRequireDefault(_reactMeasure);\n\nvar _ImageGallery = require('../../../components/ImageGallery');\n\nvar _ImageGallery2 = _interopRequireDefault(_ImageGallery);\n\nvar _imageItem = require('./imageItem.js');\n\nvar _imageItem2 = _interopRequireDefault(_imageItem);\n\nvar _Icon = require('../../../components/Icon');\n\nvar _Icon2 = _interopRequireDefault(_Icon);\n\nvar _config = require('../../../config/');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Photo = function (_Component) {\n    (0, _inherits3.default)(Photo, _Component);\n\n    function Photo(props) {\n        (0, _classCallCheck3.default)(this, Photo);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (Photo.__proto__ || (0, _getPrototypeOf2.default)(Photo)).call(this, props));\n\n        _initialiseProps.call(_this);\n\n        var photoes = props.photoes,\n            page = props.page,\n            allPage = props.allPage;\n\n        var photoSrcs = _this.addSrc(photoes);\n        _this.state = {\n            photoes: photoSrcs,\n            allPage: allPage,\n            page: page,\n            showPhotoView: false,\n            currentPhotoIndex: 0,\n            isShowImageGallery: false,\n            imageGalleryIndex: 0,\n            isLoading: false\n        };\n        return _this;\n    }\n\n    (0, _createClass3.default)(Photo, [{\n        key: 'componentWillMount',\n        value: function componentWillMount() {\n            var photoes = this.state.photoes;\n\n            if (!photoes.length) this.getPhotos(1);\n        }\n    }, {\n        key: 'componentDidMount',\n        value: function componentDidMount() {\n            this.photoLayoutDom = _reactDom2.default.findDOMNode(this);\n            this.headerDom = _reactDom2.default.findDOMNode(this.refs.photoHeader);\n            this.blogNavDom = document.getElementById('IdNav');\n\n            this.blogNavDom.classList.add('blog-photo-header');\n\n            window.addEventListener(\"scroll\", this.onscroll, false);\n        }\n    }, {\n        key: 'getPhotos',\n        value: function getPhotos(page) {\n            var _this2 = this;\n\n            if (this.state.isLoading) return;\n            this.setState({\n                isLoading: true\n            });\n            _axios2.default.get('/api/get/photoes', { params: { page: page } }).then(function (res) {\n                var photoSrcs = _this2.addSrc(res.data.photoes);\n                _this2.setState(function (preState) {\n                    var photoes = preState.photoes.concat(photoSrcs);\n                    return {\n                        page: page,\n                        photoes: photoes,\n                        allPage: res.data.allPage,\n                        isLoading: false\n                    };\n                });\n            });\n        }\n    }, {\n        key: 'componentWillUnmount',\n        value: function componentWillUnmount() {\n            window.removeEventListener(\"scroll\", this.onscroll);\n            this.blogNavDom.classList.remove('blog-photoes-header');\n        }\n    }, {\n        key: 'addSrc',\n        value: function addSrc(allphoto) {\n            var photoes = [],\n                banner = [];\n            if (allphoto && allphoto.length) {\n                allphoto.map(function (photo) {\n                    var newPho = {\n                        src: '' + _config.IMG_URL + photo.key + _config.IMG_QUERY,\n                        original: '' + _config.IMG_URL + photo.key + _config.IMG_QUERY,\n                        thumbnail: '' + _config.IMG_URL + photo.key + _config.IMG_QUERY,\n                        width: photo.width,\n                        height: photo.height,\n                        desc: photo.desc\n                    };\n\n                    photoes.push(newPho);\n                });\n            }\n\n            return photoes;\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _this3 = this;\n\n            var _state = this.state,\n                photoes = _state.photoes,\n                width = _state.width,\n                showPhotoView = _state.showPhotoView,\n                currentPhotoIndex = _state.currentPhotoIndex,\n                isShowImageGallery = _state.isShowImageGallery,\n                imageGalleryIndex = _state.imageGalleryIndex,\n                isLoading = _state.isLoading;\n\n            return _react2.default.createElement(\n                'div',\n                { className: 'blog-photo-layout' },\n                _react2.default.createElement(\n                    'section',\n                    { className: 'photo-banner', ref: 'photoHeader', style: { backgroundImage: 'url(' + (photoes[0] && photoes[0].src || '//cdn.liayal.com/14506926.jpg') + ')' } },\n                    _react2.default.createElement('img', { src: photoes[0] && photoes[0].src || '//cdn.liayal.com/14506926.jpg', alt: '' }),\n                    _react2.default.createElement(\n                        'div',\n                        { className: 'photo-banner-info' },\n                        _react2.default.createElement(\n                            'p',\n                            { className: 'small' },\n                            _react2.default.createElement(\n                                'span',\n                                null,\n                                '\\u56FE\\u8BB0'\n                            )\n                        ),\n                        _react2.default.createElement(\n                            'h2',\n                            null,\n                            photoes[0] && photoes[0].desc ? photoes[0].desc : '一起老去'\n                        )\n                    )\n                ),\n                _react2.default.createElement(\n                    'section',\n                    { className: 'middle-text tc' },\n                    _react2.default.createElement(\n                        'h2',\n                        null,\n                        '\\u6211\\u4EE5\\u4E00\\u79CD\\u7B28\\u62D9\\u7684\\u65B9\\u5F0F\\u62CD\\u7167'\n                    ),\n                    _react2.default.createElement(\n                        'p',\n                        null,\n                        '\\u6444\\u5F71\\u662F\\u4E00\\u79CD\\u795E\\u5947\\u7684\\u8BB0\\u5F55\\uFF1A\\u7167\\u7247\\u8BB0\\u5F55\\u4E86\\u65F6\\u95F4\\u3001\\u98CE\\u666F\\u3001\\u4EBA\\u7269\\uFF1B\\u53EF\\u56DE\\u653E\\u7167\\u7247\\u65F6\\u624D\\u53D1\\u73B0\\uFF0C\\u539F\\u6765\\u5B83\\u8FD8\\u8BB0\\u5F55\\u4E86\\u6309\\u4E0B\\u5FEB\\u95E8\\u65F6\\u7684\\u611F\\u89E6\\u3001\\u601D\\u7EEA\\u3001\\u5FC3\\u4E8B\\u2026\\u2026\\u4E5F\\u8BB8\\u8FD9\\u5C31\\u662F\\u4E3A\\u4EC0\\u4E48\\u660E\\u660E\\u770B\\u5230\\u7684\\u662F\\u4E00\\u5F20\\u98CE\\u666F\\uFF0C\\u5374\\u4F1A\\u8BA9\\u4F60\\u60F3\\u8D77\\u8C01'\n                    )\n                ),\n                _react2.default.createElement(\n                    _reactMeasure2.default,\n                    { bounds: true, onResize: function onResize(contentRect) {\n                            return _this3.setState({ width: contentRect.bounds.width });\n                        } },\n                    function (_ref) {\n                        var measureRef = _ref.measureRef;\n\n                        var columns = 2;\n                        if (width >= 480) {\n                            columns = 3;\n                        }\n                        if (width >= 1024) {\n                            columns = 4;\n                        }\n                        if (width >= 1824) {\n                            columns = 5;\n                        }\n                        return _react2.default.createElement(\n                            'div',\n                            { ref: measureRef, className: 'photo-list' },\n                            _react2.default.createElement(_reactPhotoGallery2.default, { photos: photoes.slice(1), margin: 4, columns: columns, ImageComponent: _imageItem2.default, onClick: _this3.selectPhoto })\n                        );\n                    }\n                ),\n                isLoading ? _react2.default.createElement(\n                    'p',\n                    { className: 'loading' },\n                    '\\u52A0\\u8F7D\\u4E2D...'\n                ) : null,\n                _react2.default.createElement(_ImageGallery2.default, { images: photoes.slice(1), isShow: isShowImageGallery, startIndex: imageGalleryIndex })\n            );\n        }\n    }]);\n    return Photo;\n}(_react.Component);\n\nPhoto.defaultProps = {\n    photoes: [],\n    page: 1,\n    allPage: 0\n};\n\nvar _initialiseProps = function _initialiseProps() {\n    var _this4 = this;\n\n    this.onscroll = function (e) {\n        e = e || window.event;\n        var _scrollTop = window.pageYOffset || document.documentElement && document.documentElement.scrollTop || document.body.scrollTop || 0;\n\n        if (_scrollTop >= _this4.headerDom.offsetHeight - _this4.blogNavDom.offsetHeight) {\n            _this4.blogNavDom.classList.remove('blog-photoes-header');\n        } else {\n            _this4.blogNavDom.classList.add('blog-photoes-header');\n        }\n\n        var _state2 = _this4.state,\n            page = _state2.page,\n            allPage = _state2.allPage;\n\n        if (_scrollTop + document.documentElement.clientHeight > _this4.photoLayoutDom.offsetHeight - 150) {\n            page < allPage && _this4.getPhotos(page + 1);\n        }\n    };\n\n    this.selectPhoto = function (e, data) {\n        _this4.setState({\n            isShowImageGallery: true,\n            imageGalleryIndex: data.index\n        });\n    };\n};\n\nexports.default = Photo;",null]}