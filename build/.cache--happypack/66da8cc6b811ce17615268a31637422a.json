{"remainingRequest":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js?{\"presets\":[\"react-hmre\"]}!/Users/mael.liang/Workspace/node-koa-test/web/page/admin/PhotoManage/index.js","dependencies":[{"path":"/Users/mael.liang/Workspace/node-koa-test/web/page/admin/PhotoManage/index.js","mtime":1514439843000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _upload = require('antd/lib/upload');\n\nvar _upload2 = _interopRequireDefault(_upload);\n\nvar _pagination = require('antd/lib/pagination');\n\nvar _pagination2 = _interopRequireDefault(_pagination);\n\nvar _col = require('antd/lib/col');\n\nvar _col2 = _interopRequireDefault(_col);\n\nvar _card = require('antd/lib/card');\n\nvar _card2 = _interopRequireDefault(_card);\n\nvar _tooltip = require('antd/lib/tooltip');\n\nvar _tooltip2 = _interopRequireDefault(_tooltip);\n\nvar _icon = require('antd/lib/icon');\n\nvar _icon2 = _interopRequireDefault(_icon);\n\nvar _button = require('antd/lib/button');\n\nvar _button2 = _interopRequireDefault(_button);\n\nvar _modal = require('antd/lib/modal');\n\nvar _modal2 = _interopRequireDefault(_modal);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _input = require('antd/lib/input');\n\nvar _input2 = _interopRequireDefault(_input);\n\nvar _layout = require('antd/lib/layout');\n\nvar _layout2 = _interopRequireDefault(_layout);\n\nvar _index = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/redbox-react/lib/index.js');\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _index3 = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/react-transform-catch-errors/lib/index.js');\n\nvar _index4 = _interopRequireDefault(_index3);\n\nvar _react2 = require('react');\n\nvar _react3 = _interopRequireDefault(_react2);\n\nvar _index5 = require('/Users/mael.liang/Workspace/node-koa-test/node_modules/react-transform-hmr/lib/index.js');\n\nvar _index6 = _interopRequireDefault(_index5);\n\nvar _class, _temp;\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _reactMasonryComponent = require('react-masonry-component');\n\nvar _reactMasonryComponent2 = _interopRequireDefault(_reactMasonryComponent);\n\nvar _config = require('../../../config/');\n\nrequire('./index.less');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _components = {\n    ArticleManege: {\n        displayName: 'ArticleManege'\n    }\n};\n\nvar _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformHmrLibIndexJs2 = (0, _index6.default)({\n    filename: '/Users/mael.liang/Workspace/node-koa-test/web/page/admin/PhotoManage/index.js',\n    components: _components,\n    locals: [module],\n    imports: [_react3.default]\n});\n\nvar _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformCatchErrorsLibIndexJs2 = (0, _index4.default)({\n    filename: '/Users/mael.liang/Workspace/node-koa-test/web/page/admin/PhotoManage/index.js',\n    components: _components,\n    locals: [],\n    imports: [_react3.default, _index2.default]\n});\n\nfunction _wrapComponent(id) {\n    return function (Component) {\n        return _UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformHmrLibIndexJs2(_UsersMaelLiangWorkspaceNodeKoaTestNode_modulesReactTransformCatchErrorsLibIndexJs2(Component, id), id);\n    };\n}\n\nvar Header = _layout2.default.Header,\n    Content = _layout2.default.Content,\n    Footer = _layout2.default.Footer;\nvar TextArea = _input2.default.TextArea;\n\nvar ArticleManege = _wrapComponent('ArticleManege')((_temp = _class = function (_Component) {\n    (0, _inherits3.default)(ArticleManege, _Component);\n\n    function ArticleManege(props) {\n        (0, _classCallCheck3.default)(this, ArticleManege);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (ArticleManege.__proto__ || (0, _getPrototypeOf2.default)(ArticleManege)).call(this, props));\n\n        _this.showAddPhoto = function () {\n            _this.setState({\n                addPhotoStatus: true\n            });\n        };\n\n        _this.closeAddPhoto = function () {\n            _this.setState({\n                addPhotoStatus: false\n            });\n        };\n\n        _this.handleCancelPreview = function () {\n            return _this.setState({\n                previewVisible: false\n            });\n        };\n\n        _this.uploaderPreview = function (file) {\n            _this.setState({\n                previewImage: file.url || file.thumbUrl,\n                previewVisible: true\n            });\n        };\n\n        _this.uploadereChange = function (_ref) {\n            var file = _ref.file,\n                fileList = _ref.fileList,\n                event = _ref.event;\n\n            _this.setState({ fileList: fileList });\n        };\n\n        _this.descInputChange = function (e) {\n            return _this.setState({ desc: e.target.value });\n        };\n\n        _this.uploaderRemove = function () {};\n\n        _this.addToPhoto = function () {\n            var _this$state = _this.state,\n                fileList = _this$state.fileList,\n                desc = _this$state.desc;\n\n\n            var photoes = fileList.map(function (file) {\n                var response = file.response;\n\n                if (file.status == 'done') return {\n                    name: response.data.filename,\n                    key: response.data.key,\n                    width: response.data.w,\n                    height: response.data.h,\n                    desc: desc\n                };\n            });\n\n            if (!photoes.length) return;\n\n            _axios2.default.post('/api/add/photo', photoes).then(function (res) {\n                var resData = res.data;\n                if (resData.code == 200) {\n                    _this.getPhotoes();\n                    _this.setState({ fileList: [] });\n                }\n            });\n        };\n\n        _this.setToBanner = function (photoIndex) {\n            var photoes = _this.state.photoes;\n\n            var photo = photoes[photoIndex],\n                isBanner = photo.isBanner;\n\n            if (photo.id) _axios2.default.post('/api/update/photo/' + photo.id, { isBanner: !isBanner }).then(function (res) {\n                var resData = res.data;\n                if (resData.code == 200) {\n                    photoes[photoIndex].isBanner = !isBanner;\n                    _this.setState({ photoes: photoes });\n                } else {\n                    _this.context.showMessage(resData.message);\n                }\n            });\n        };\n\n        _this.changPhotoText = function (event, photo) {\n            event.target.blur();\n            _axios2.default.post('/api/update/photo/' + photo.id, { desc: event.target.value }).then(function (res) {\n                var resData = res.data;\n                if (resData.code == 200) {\n                    _this.context.showMessage(\"修改成功\");\n                } else {\n                    _this.context.showMessage(resData.message);\n                }\n            });\n        };\n\n        _this.deletePhoto = function (photo) {\n            _modal2.default.confirm({\n                title: '确定删除照片?',\n                content: '照片删除后不可恢复',\n                okText: '删除',\n                okType: 'danger',\n                cancelText: '取消',\n                onOk: function onOk() {\n                    return _this.doDelete(photo.id);\n                }\n            });\n        };\n\n        _this.changePage = function (page) {\n            _this.getPhotoes(page);\n        };\n\n        _this.state = {\n            previewVisible: false,\n            previewImage: '',\n            fileList: [],\n            file: null,\n            desc: '',\n            photoes: [],\n            one: [],\n            uploadRvent: null,\n            addPhotoStatus: false,\n            pageSize: 12,\n            page: 1,\n            allNum: 0,\n            allPage: 0\n        };\n        return _this;\n    }\n\n    (0, _createClass3.default)(ArticleManege, [{\n        key: 'componentWillMount',\n        value: function componentWillMount() {\n            this.getPhotoes(1);\n            this.getOne();\n        }\n    }, {\n        key: 'getPhotoes',\n        value: function getPhotoes(_page) {\n            var _this2 = this;\n\n            var _state = this.state,\n                pageSize = _state.pageSize,\n                page = _state.page;\n\n            _axios2.default.get('/api/get/photoes', {\n                params: {\n                    page: _page || page,\n                    size: pageSize\n                }\n            }).then(function (res) {\n                var resData = res.data;\n                var photoes = resData.photoes.map(function (img) {\n                    return {\n                        imgUrl: '' + _config.IMG_URL + img.key + '?' + _config.IMG_QUERY,\n                        key: img.key,\n                        text: img.desc,\n                        id: img.id,\n                        isBanner: img.isBanner || false\n                    };\n                });\n                _this2.setState({ photoes: photoes, page: _page, allPage: resData.allPage, allNum: resData.allNum });\n            });\n        }\n    }, {\n        key: 'getOne',\n        value: function getOne() {\n            var _this3 = this;\n\n            _axios2.default.get('/api/one').then(function (res) {\n                _this3.setState({\n                    one: res.data.data\n                });\n            });\n        }\n    }, {\n        key: 'doDelete',\n        value: function doDelete(id) {\n            var _this4 = this;\n\n            return _axios2.default.delete('/api/photo/' + id).then(function (res) {\n                _this4.context.showMessage(res.data.message);\n                if (res.data.code == 200) {\n                    _this4.getPhotoes();\n                }\n            }).catch(function (err) {\n                _this4.context.showMessage(err);\n            });\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _this5 = this;\n\n            var _state2 = this.state,\n                previewVisible = _state2.previewVisible,\n                previewImage = _state2.previewImage,\n                addPhotoStatus = _state2.addPhotoStatus,\n                fileList = _state2.fileList,\n                photoes = _state2.photoes,\n                one = _state2.one,\n                pageSize = _state2.pageSize,\n                page = _state2.page,\n                allNum = _state2.allNum,\n                allPage = _state2.allPage;\n\n            var data = photoes.length ? photoes : one;\n            return _react3.default.createElement(\n                _layout2.default,\n                { className: 'photo-manage-layout' },\n                _react3.default.createElement(\n                    Header,\n                    { className: 'photo-manage-header clearfix' },\n                    _react3.default.createElement(\n                        'h2',\n                        null,\n                        ' \\u56FE \\u96C6 '\n                    ),\n                    _react3.default.createElement(\n                        'div',\n                        { className: 'fr' },\n                        _react3.default.createElement(\n                            _button2.default,\n                            { icon: 'plus', onClick: this.showAddPhoto },\n                            '\\u6DFB\\u52A0\\u56FE\\u7247'\n                        )\n                    )\n                ),\n                _react3.default.createElement(\n                    Content,\n                    { className: 'photo-manage-content' },\n                    _react3.default.createElement(\n                        _reactMasonryComponent2.default,\n                        { className: 'photo-list' },\n                        data.length ? data.map(function (item, i) {\n                            return _react3.default.createElement(\n                                _col2.default,\n                                { span: 8, key: i },\n                                _react3.default.createElement(\n                                    _card2.default,\n                                    { bodyStyle: { padding: 0 } },\n                                    _react3.default.createElement(\n                                        'div',\n                                        { className: 'one-image' },\n                                        _react3.default.createElement('img', { src: item.imgUrl })\n                                    ),\n                                    _react3.default.createElement(\n                                        'div',\n                                        { className: 'one-card' },\n                                        _react3.default.createElement(\n                                            'div',\n                                            { className: 'text' },\n                                            _react3.default.createElement(_input2.default, { className: 'text-input', onPressEnter: function onPressEnter(e) {\n                                                    _this5.changPhotoText(e, item);\n                                                }, defaultValue: item.text, key: item.text })\n                                        ),\n                                        _react3.default.createElement(\n                                            'div',\n                                            { className: 'banner-setting', onClick: function onClick() {\n                                                    _this5.setToBanner(i);\n                                                } },\n                                            _react3.default.createElement(\n                                                _tooltip2.default,\n                                                { placement: 'top', title: item.isBanner ? '点击取消设置为Banner' : '点击设置为Banner' },\n                                                _react3.default.createElement(_icon2.default, { type: item.isBanner ? \"heart\" : \"heart-o\" })\n                                            )\n                                        )\n                                    ),\n                                    _react3.default.createElement(_icon2.default, { type: 'delete', className: 'photo-delete', onClick: function onClick(e) {\n                                            _this5.deletePhoto(item);\n                                        } })\n                                )\n                            );\n                        }) : null\n                    )\n                ),\n                allPage > 1 ? _react3.default.createElement(\n                    Footer,\n                    null,\n                    _react3.default.createElement(_pagination2.default, { className: 'tc', showQuickJumper: true, current: page, total: allNum, onChange: this.changePage, pageSize: pageSize })\n                ) : null,\n                _react3.default.createElement(\n                    _modal2.default,\n                    { visible: previewVisible, footer: null, onCancel: this.handleCancelPreview },\n                    _react3.default.createElement('img', { alt: 'example', style: { width: '100%' }, src: previewImage })\n                ),\n                _react3.default.createElement(\n                    _modal2.default,\n                    { visible: addPhotoStatus, footer: null, className: 'upload-modal', onCancel: this.closeAddPhoto },\n                    _react3.default.createElement(\n                        'div',\n                        { className: 'upload-modal-content' },\n                        _react3.default.createElement(\n                            _upload2.default,\n                            {\n                                className: 'uploader',\n                                accept: 'image/*',\n                                action: '/api/fileupload',\n                                listType: 'picture',\n                                fileList: fileList,\n                                data: { prefix: 'photo/' },\n                                onPreview: this.uploaderPreview,\n                                onRemove: this.uploaderRemove,\n                                onChange: this.uploadereChange },\n                            _react3.default.createElement(\n                                'div',\n                                { className: 'upload-plus' },\n                                _react3.default.createElement(_icon2.default, { type: 'picture' }),\n                                _react3.default.createElement(\n                                    'span',\n                                    { className: 'ant-upload-text' },\n                                    ' \\u9009\\u62E9\\u6587\\u4EF6\\u4E0A\\u4F20'\n                                )\n                            )\n                        ),\n                        _react3.default.createElement(TextArea, { placeholder: '\\u6DFB\\u52A0\\u6587\\u4EF6\\u63CF\\u8FF0', autosize: { minRows: 2, maxRows: 6 }, onChange: this.descInputChange }),\n                        _react3.default.createElement(\n                            _button2.default,\n                            { size: 'large', type: 'primary', icon: 'save', onClick: this.addToPhoto },\n                            '\\u4FDD\\u5B58'\n                        )\n                    )\n                )\n            );\n        }\n    }]);\n    return ArticleManege;\n}(_react2.Component), _class.contextTypes = {\n    showMessage: _propTypes2.default.func\n}, _temp));\n\nexports.default = ArticleManege;",{"version":3,"sources":["web/page/admin/PhotoManage/index.js"],"names":["Header","Content","Footer","TextArea","props","showAddPhoto","setState","addPhotoStatus","closeAddPhoto","handleCancelPreview","previewVisible","uploaderPreview","file","previewImage","url","thumbUrl","uploadereChange","fileList","event","descInputChange","desc","e","target","value","uploaderRemove","addToPhoto","state","photoes","map","response","status","name","data","filename","key","width","w","height","h","length","post","then","resData","res","code","getPhotoes","setToBanner","photoIndex","photo","isBanner","id","context","showMessage","message","changPhotoText","blur","deletePhoto","confirm","title","content","okText","okType","cancelText","onOk","doDelete","changePage","page","one","uploadRvent","pageSize","allNum","allPage","getOne","_page","get","params","size","imgUrl","img","text","delete","catch","err","item","i","padding","prefix","minRows","maxRows","contextTypes","func"],"mappings":"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","file":"index.js","sourceRoot":"/Users/mael.liang/Workspace/node-koa-test","sourcesContent":["import React, { Component } from 'react';\nimport { Layout, Icon, Upload, Modal, Input, Button, Card, Col, Tooltip, Pagination } from 'antd';\nimport PropTypes from 'prop-types';\nimport Axios from 'axios';\nimport Masonry from 'react-masonry-component';\nimport {IMG_URL, IMG_QUERY} from '../../../config/';\nimport './index.less';\n\nconst { Header, Content, Footer } = Layout;\nconst { TextArea } = Input;\n\nexport default class ArticleManege extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            previewVisible: false,\n            previewImage: '',\n            fileList: [],\n            file: null,\n            desc: '',\n            photoes: [],\n            one:[],\n            uploadRvent: null,\n            addPhotoStatus: false,\n            pageSize: 12,\n            page: 1,\n            allNum: 0,\n            allPage: 0\n        };\n    }\n\n    static contextTypes = {\n        showMessage: PropTypes.func\n    };\n\n    componentWillMount() {\n        this.getPhotoes(1);\n        this.getOne();\n    }\n\n    showAddPhoto = () => {\n        this.setState({\n            addPhotoStatus: true\n        })\n    }\n\n    getPhotoes(_page) {\n        const { pageSize, page } = this.state;\n        Axios.get('/api/get/photoes', {\n            params: {\n                page: _page || page,\n                size: pageSize\n            }\n        })\n        .then(res => {\n            let resData = res.data;\n            let photoes = resData.photoes.map(img => {\n                return {\n                    imgUrl: `${IMG_URL}${img.key}?${IMG_QUERY}`,\n                    key: img.key,\n                    text: img.desc,\n                    id: img.id,\n                    isBanner: img.isBanner || false\n                }\n            });\n            this.setState({photoes, page: _page, allPage: resData.allPage, allNum: resData.allNum})\n        })\n    }\n\n    getOne() {\n        Axios.get('/api/one')\n            .then( res => {\n                this.setState({\n                    one: res.data.data\n                })\n            });\n    }\n\n    closeAddPhoto = () => {\n        this.setState({\n            addPhotoStatus: false\n        })\n    }\n\n    handleCancelPreview = () => this.setState({\n        previewVisible: false\n    })\n\n    uploaderPreview = (file) => {\n        this.setState({\n            previewImage: file.url || file.thumbUrl,\n            previewVisible: true,\n        });\n    }\n\n    uploadereChange = ({ file, fileList, event }) => {\n        this.setState({fileList})\n    }\n\n    descInputChange = e => this.setState({desc: e.target.value})\n\n    uploaderRemove =  () => {\n    }\n\n    addToPhoto = () => {\n        const { fileList, desc } = this.state;\n\n        let photoes = fileList.map( file => {\n            const { response } = file;\n            if ( file.status == 'done')\n                return {\n                    name: response.data.filename,\n                    key: response.data.key,\n                    width: response.data.w,\n                    height: response.data.h,\n                    desc: desc\n                }\n        })\n\n\n        if (!photoes.length) return;\n\n        Axios.post('/api/add/photo', photoes)\n            .then( res => {\n                let resData = res.data;\n                if (resData.code == 200) {\n                    this.getPhotoes()\n                    this.setState({fileList: []})\n                }\n            })\n    }\n\n    setToBanner = (photoIndex) => {\n        const { photoes } = this.state;\n        let photo = photoes[photoIndex],\n            isBanner = photo.isBanner;\n\n        if (photo.id)\n            Axios.post(`/api/update/photo/${photo.id}`, {isBanner: !isBanner})\n                .then( res => {\n                    let resData = res.data;\n                    if ( resData.code == 200) {\n                        photoes[photoIndex].isBanner = !isBanner;\n                        this.setState({photoes});\n                    } else {\n                        this.context.showMessage(resData.message);\n                    }\n                })\n    }\n\n    changPhotoText = (event, photo) => {\n        event.target.blur();\n        Axios.post(`/api/update/photo/${photo.id}`, {desc: event.target.value})\n            .then( res => {\n                let resData = res.data;\n                if ( resData.code == 200) {\n                    this.context.showMessage(\"修改成功\");\n                } else {\n                    this.context.showMessage(resData.message);\n                }\n            })\n    }\n\n    deletePhoto = photo => {\n        Modal.confirm({\n            title: '确定删除照片?',\n            content: '照片删除后不可恢复',\n            okText: '删除',\n            okType: 'danger',\n            cancelText: '取消',\n            onOk: () => {\n                return this.doDelete(photo.id);\n            }\n        });\n    }\n\n    doDelete(id) {\n        return Axios\n            .delete(`/api/photo/${id}`)\n            .then( res => {\n                this.context.showMessage(res.data.message);\n                if (res.data.code == 200) {\n                    this.getPhotoes();\n                }\n            })\n            .catch( err => {\n                this.context.showMessage(err);\n            })\n    }\n\n    changePage = page => {\n        this.getPhotoes(page);\n    }\n\n    render() {\n        const { previewVisible, previewImage, addPhotoStatus, fileList, photoes, one, pageSize, page, allNum, allPage } = this.state;\n        let data = photoes.length ? photoes : one;\n        return ( <Layout className = \"photo-manage-layout\" >\n                <Header className = 'photo-manage-header clearfix' >\n                    <h2 > 图 集 </h2>\n                    <div  className='fr'><Button icon='plus' onClick={ this.showAddPhoto } >添加图片</Button></div>\n                </Header>\n                <Content className = \"photo-manage-content\" >\n                    <Masonry className=\"photo-list\">\n                        { data.length ? data.map( (item, i) =>  <Col span={8} key={i} >\n                            <Card bodyStyle={{ padding: 0 }} >\n                                <div className=\"one-image\">\n                                    <img src={item.imgUrl} />\n                                </div>\n                                <div className=\"one-card\">\n                                    <div className=\"text\">\n                                        <Input  className='text-input' onPressEnter={ e => { this.changPhotoText(e, item) } } defaultValue={item.text} key={item.text}/>\n                                    </div>\n                                    <div className=\"banner-setting\" onClick={ () => {this.setToBanner(i)} }>\n                                    <Tooltip placement=\"top\" title={item.isBanner ? '点击取消设置为Banner' : '点击设置为Banner'}>\n                                        <Icon type={ item.isBanner ? \"heart\" :\"heart-o\" }  />\n                                    </Tooltip>\n                                    </div>\n                                </div>\n                                <Icon type=\"delete\" className=\"photo-delete\" onClick={ e => {this.deletePhoto(item)} } />\n                            </Card></Col>) : null }\n                    </Masonry>\n                </Content>\n                { (allPage > 1) ? <Footer><Pagination className='tc' showQuickJumper current={ page }  total={allNum} onChange={ this.changePage } pageSize={pageSize} /></Footer> : null}\n                <Modal visible = { previewVisible } footer = { null } onCancel = { this.handleCancelPreview } >\n                    <img alt = \"example\" style = { { width: '100%' } } src = { previewImage }/>\n                </Modal>\n\n                <Modal visible = { addPhotoStatus } footer = { null } className=\"upload-modal\" onCancel={ this.closeAddPhoto } >\n                    <div className=\"upload-modal-content\">\n                        <Upload\n                            className='uploader'\n                            accept = \"image/*\"\n                            action = \"/api/fileupload\"\n                            listType='picture'\n                            fileList={fileList}\n                            data = { { prefix: 'photo/' } }\n                            onPreview = { this.uploaderPreview }\n                            onRemove = { this.uploaderRemove }\n                            onChange = { this.uploadereChange } >\n                            <div className='upload-plus'>\n                                <Icon type=\"picture\" />\n                                <span className = \"ant-upload-text\" > 选择文件上传</span>\n                            </div>\n                        </Upload>\n                        <TextArea placeholder=\"添加文件描述\" autosize={{ minRows: 2, maxRows: 6 }} onChange={ this.descInputChange } />\n                        <Button size='large' type=\"primary\" icon=\"save\" onClick={ this.addToPhoto } >保存</Button>\n                    </div>\n                </Modal>\n            </Layout>)\n        }\n    }"]}]}