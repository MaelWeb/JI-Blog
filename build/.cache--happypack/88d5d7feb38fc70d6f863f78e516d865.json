{"remainingRequest":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js?{\"presets\":[]}!/Users/mael.liang/Workspace/node-koa-test/web/page/admin/BlogBanner/index.js","dependencies":[{"path":"/Users/mael.liang/Workspace/node-koa-test/web/page/admin/BlogBanner/index.js","mtime":1519640424553},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _tooltip = require('antd/lib/tooltip');\n\nvar _tooltip2 = _interopRequireDefault(_tooltip);\n\nvar _upload = require('antd/lib/upload');\n\nvar _upload2 = _interopRequireDefault(_upload);\n\nvar _button = require('antd/lib/button');\n\nvar _button2 = _interopRequireDefault(_button);\n\nvar _icon = require('antd/lib/icon');\n\nvar _icon2 = _interopRequireDefault(_icon);\n\nvar _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');\n\nvar _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _message2 = require('antd/lib/message');\n\nvar _message3 = _interopRequireDefault(_message2);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _input = require('antd/lib/input');\n\nvar _input2 = _interopRequireDefault(_input);\n\nvar _layout = require('antd/lib/layout');\n\nvar _layout2 = _interopRequireDefault(_layout);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactRouterDom = require('react-router-dom');\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _config = require('../../../config/');\n\nrequire('./index.less');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Header = _layout2.default.Header,\n    Content = _layout2.default.Content,\n    Footer = _layout2.default.Footer;\nvar TextArea = _input2.default.TextArea;\n\nvar BannerSetting = function (_Component) {\n    (0, _inherits3.default)(BannerSetting, _Component);\n\n    function BannerSetting(props) {\n        (0, _classCallCheck3.default)(this, BannerSetting);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (BannerSetting.__proto__ || (0, _getPrototypeOf2.default)(BannerSetting)).call(this, props));\n\n        _this.uploadereChange = function (info) {\n            if (info.file.status === 'done') {\n                _message3.default.success(\"上传成功\");\n                var response = info.file.response;\n\n                _this.setState({\n                    imageUpUrl: '' + _config.IMG_URL + response.data.key,\n                    imageUrl: '' + _config.IMG_URL + response.data.key\n                });\n            }\n        };\n\n        _this.imgInputChange = function (e) {\n            _this.setState({\n                imageUrl: e.target.value\n            });\n        };\n\n        _this.textChange = function (e) {\n            _this.setState({\n                text: e.target.value\n            });\n        };\n\n        _this.hrefChange = function (e) {\n            _this.setState({\n                href: e.target.value\n            });\n        };\n\n        _this.bookNameChange = function (e) {\n            var book = _this.state.book;\n\n            book.author = e.target.value;\n\n            _this.setState({ book: book });\n        };\n\n        _this.bookTextChange = function (e) {\n            var book = _this.state.book;\n\n            book.text = e.target.value.split('||');\n            _this.setState({ book: book });\n        };\n\n        _this.bookHrefChange = function (e) {\n            var book = _this.state.book;\n\n            book.href = e.target.value.split('||');\n            _this.setState({ book: book });\n        };\n\n        _this.addBanner = function (page) {\n            var _this$state = _this.state,\n                imageUrl = _this$state.imageUrl,\n                text = _this$state.text,\n                href = _this$state.href,\n                book = _this$state.book;\n\n            var params = {};\n\n            if (page == 'HOME') {\n                params = { url: imageUrl, text: [text], href: href, page: page };\n            } else {\n                params = (0, _extends3.default)({}, book, { page: page });\n            }\n\n            _axios2.default.post('/api/create/banner', params).then(function (res) {\n                if (res.data.code == 200) {\n                    _message3.default.success(\"添加成功\");\n                    _this.getBanners();\n                } else {\n                    _message3.default.error(\"添加失败\");\n                }\n            });\n        };\n\n        _this.bannerUploaderChange = function (info, index) {\n            if (info.file.status === 'done') {\n                _message3.default.success(\"上传成功\");\n                var response = info.file.response;\n\n                _this.setState(function (preState) {\n                    preState.banners[index].url = '' + _config.IMG_URL + response.data.key;\n\n                    return { banners: preState.banners };\n                });\n            }\n        };\n\n        _this.bannerImgInputChange = function (e, index) {\n            var value = e.target.value;\n            _this.setState(function (preState) {\n                preState.banners[index].url = value;\n\n                return { banners: preState.banners };\n            });\n        };\n\n        _this.bannerTextChange = function (e, index) {\n            var value = e.target.value;\n            _this.setState(function (preState) {\n                preState.banners[index].text = value;\n\n                return { banners: preState.banners };\n            });\n        };\n\n        _this.bannerHrefChange = function (e, index) {\n            var value = e.target.value;\n            _this.setState(function (preState) {\n                preState.banners[index].href = value;\n\n                return { banners: preState.banners };\n            });\n        };\n\n        _this.updateBanner = function (banner) {\n            var id = banner.id,\n                others = (0, _objectWithoutProperties3.default)(banner, ['id']);\n\n            _axios2.default.post('/api/update/banner/' + id, others).then(function (res) {\n                _message3.default.success(res.data.message);\n            });\n        };\n\n        _this.deleteBanner = function (banner) {\n            _axios2.default.delete('/api/banner/' + banner.id).then(function (res) {\n                _message3.default.success(res.data.message);\n                if (res.data.code == 200) {\n                    _this.getBanners();\n                }\n            });\n        };\n\n        _this.state = {\n            imageUrl: '',\n            imageUpUrl: '',\n            text: '',\n            href: '',\n            banners: [],\n            book: {\n                text: [],\n                author: '',\n                href: ''\n            }\n        };\n\n        return _this;\n    }\n\n    (0, _createClass3.default)(BannerSetting, [{\n        key: 'componentWillMount',\n        value: function componentWillMount() {\n            this.getBanners();\n        }\n    }, {\n        key: 'getBanners',\n        value: function getBanners() {\n            var _this2 = this;\n\n            _axios2.default.get(\"/api/get/banners\").then(function (res) {\n                var book = _this2.state.book;\n\n                var banners = [];\n\n                res.data.banners.map(function (banner) {\n                    banner.page == 'HOME' && banners.push(banner);\n                    banner.page == 'BOOK' && (book = banner);\n                });\n                _this2.setState({\n                    banners: banners,\n                    book: book\n                });\n            });\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _this3 = this;\n\n            var _state = this.state,\n                imageUrl = _state.imageUrl,\n                imageUpUrl = _state.imageUpUrl,\n                text = _state.text,\n                href = _state.href,\n                banners = _state.banners,\n                book = _state.book,\n                title = _state.title;\n\n            return _react2.default.createElement(\n                _layout2.default,\n                { className: 'banner-setting-layout' },\n                _react2.default.createElement(\n                    Header,\n                    { className: 'banner-setting-header clearfix' },\n                    _react2.default.createElement(\n                        'h3',\n                        null,\n                        '\\u5934\\u56FE\\u8BBE\\u7F6E'\n                    )\n                ),\n                _react2.default.createElement(\n                    Content,\n                    { className: 'banner-setting-content' },\n                    _react2.default.createElement(\n                        'h2',\n                        null,\n                        '\\u535A\\u5BA2\\u9996\\u9875'\n                    ),\n                    banners.length ? banners.map(function (banner, index) {\n                        return _react2.default.createElement(\n                            'div',\n                            { className: 'banner-box', key: banner.id },\n                            _react2.default.createElement(\n                                'div',\n                                { className: 'banner-img' },\n                                banner.url ? _react2.default.createElement('img', { src: banner.url, alt: '' }) : _react2.default.createElement(_icon2.default, { type: 'picture' })\n                            ),\n                            _react2.default.createElement(\n                                'div',\n                                { className: 'banner-info' },\n                                _react2.default.createElement(\n                                    'label',\n                                    { htmlFor: '' },\n                                    _react2.default.createElement(\n                                        'span',\n                                        { className: 'laberl-text' },\n                                        '\\u56FE\\u7247\\u5730\\u5740'\n                                    ),\n                                    _react2.default.createElement(_input2.default, { placeholder: '\\u8BF7\\u8F93\\u5165\\u56FE\\u7247\\u5730\\u5740\\u6216\\u624B\\u52A8\\u4E0A\\u4F20', value: banner.url, onChange: function onChange(e) {\n                                            _this3.bannerImgInputChange(e, index);\n                                        } }),\n                                    _react2.default.createElement(\n                                        _upload2.default,\n                                        {\n                                            className: 'uploader',\n                                            accept: 'image/*',\n                                            action: '/api/fileupload',\n                                            data: { prefix: 'banner/' },\n                                            showUploadList: false,\n                                            onChange: function onChange(info) {\n                                                _this3.bannerUploaderChange(info, index);\n                                            } },\n                                        _react2.default.createElement(\n                                            _button2.default,\n                                            null,\n                                            _react2.default.createElement(_icon2.default, { type: 'upload' }),\n                                            '\\u70B9\\u51FB\\u4E0A\\u4F20'\n                                        )\n                                    )\n                                ),\n                                _react2.default.createElement(\n                                    'label',\n                                    { htmlFor: '' },\n                                    _react2.default.createElement(\n                                        'span',\n                                        { className: 'laberl-text' },\n                                        '\\u63CF\\u8FF0'\n                                    ),\n                                    _react2.default.createElement(_input2.default, { placeholder: '\\u8BF7\\u8F93\\u5165Banner\\u63CF\\u8FF0', value: banner.text, onChange: function onChange(e) {\n                                            _this3.bannerTextChange(e, index);\n                                        } })\n                                ),\n                                _react2.default.createElement(\n                                    'label',\n                                    { htmlFor: '' },\n                                    _react2.default.createElement(\n                                        'span',\n                                        { className: 'laberl-text' },\n                                        '\\u94FE\\u63A5'\n                                    ),\n                                    _react2.default.createElement(_input2.default, { placeholder: '\\u8BF7\\u8F93\\u5165Banner\\u76F8\\u5173\\u6587\\u7AE0\\u94FE\\u63A5', value: banner.href, onChange: function onChange(e) {\n                                            _this3.bannerHrefChange(e, index);\n                                        } })\n                                )\n                            ),\n                            _react2.default.createElement(\n                                'div',\n                                { className: 'btn' },\n                                _react2.default.createElement(\n                                    _button2.default,\n                                    { onClick: function onClick() {\n                                            _this3.updateBanner(banner);\n                                        } },\n                                    '\\u4FDD\\u5B58'\n                                ),\n                                _react2.default.createElement(\n                                    _button2.default,\n                                    { onClick: function onClick() {\n                                            _this3.deleteBanner(banner);\n                                        } },\n                                    '\\u5220\\u9664'\n                                )\n                            )\n                        );\n                    }) : null,\n                    banners.length < 3 ? _react2.default.createElement(\n                        'div',\n                        { className: 'banner-box' },\n                        _react2.default.createElement(\n                            'div',\n                            { className: 'banner-img' },\n                            imageUpUrl ? _react2.default.createElement('img', { src: imageUpUrl, alt: '' }) : _react2.default.createElement(_icon2.default, { type: 'picture' })\n                        ),\n                        _react2.default.createElement(\n                            'div',\n                            { className: 'banner-info' },\n                            _react2.default.createElement(\n                                'label',\n                                { htmlFor: '' },\n                                _react2.default.createElement(\n                                    'span',\n                                    { className: 'laberl-text' },\n                                    '\\u56FE\\u7247\\u5730\\u5740'\n                                ),\n                                _react2.default.createElement(_input2.default, { placeholder: '\\u8BF7\\u8F93\\u5165\\u56FE\\u7247\\u5730\\u5740\\u6216\\u624B\\u52A8\\u4E0A\\u4F20', value: imageUrl, onChange: this.imgInputChange }),\n                                _react2.default.createElement(\n                                    _upload2.default,\n                                    {\n                                        className: 'uploader',\n                                        accept: 'image/*',\n                                        action: '/api/fileupload',\n                                        data: { prefix: 'banner/' },\n                                        showUploadList: false,\n                                        onChange: this.uploadereChange },\n                                    _react2.default.createElement(\n                                        _button2.default,\n                                        null,\n                                        _react2.default.createElement(_icon2.default, { type: 'upload' }),\n                                        '\\u70B9\\u51FB\\u4E0A\\u4F20'\n                                    )\n                                )\n                            ),\n                            _react2.default.createElement(\n                                'label',\n                                { htmlFor: '' },\n                                _react2.default.createElement(\n                                    'span',\n                                    { className: 'laberl-text' },\n                                    '\\u63CF\\u8FF0'\n                                ),\n                                _react2.default.createElement(_input2.default, { placeholder: '\\u8BF7\\u8F93\\u5165Banner\\u63CF\\u8FF0', value: text, onChange: this.textChange })\n                            ),\n                            _react2.default.createElement(\n                                'label',\n                                { htmlFor: '' },\n                                _react2.default.createElement(\n                                    'span',\n                                    { className: 'laberl-text' },\n                                    '\\u94FE\\u63A5'\n                                ),\n                                _react2.default.createElement(_input2.default, { placeholder: '\\u8BF7\\u8F93\\u5165Banner\\u76F8\\u5173\\u6587\\u7AE0\\u94FE\\u63A5', value: href, onChange: this.hrefChange })\n                            )\n                        ),\n                        _react2.default.createElement(\n                            'div',\n                            { className: 'btn' },\n                            _react2.default.createElement(\n                                _button2.default,\n                                { onClick: function onClick() {\n                                        _this3.addBanner(\"HOME\");\n                                    } },\n                                '\\u6DFB\\u52A0'\n                            )\n                        )\n                    ) : null,\n                    _react2.default.createElement(\n                        'h2',\n                        null,\n                        '\\u56FE\\u4E66\\u9996\\u9875'\n                    ),\n                    _react2.default.createElement(\n                        'div',\n                        { className: 'banner-box book-banner' },\n                        _react2.default.createElement(\n                            _tooltip2.default,\n                            {\n                                trigger: ['focus'],\n                                title: '\\u5EFA\\u8BAE\\u8F93\\u5165150\\u4E2A\\u4EE5\\u5185\\u5B57\\u7B26\\uFF0C\\u5DF2\\u7ECF\\u8F93\\u5165' + book.text.join(\"||\").length + '\\u4E2A',\n                                placement: 'topLeft',\n                                overlayClassName: 'numeric-input'\n                            },\n                            _react2.default.createElement(TextArea, { ref: 'bookText', value: book.text.join(\"||\"), onChange: this.bookTextChange, className: 'book-text', placeholder: '\\u56FE\\u4E66\\u9996\\u9875\\u6587\\u6848\\uFF0C\\u5206\\u4E24\\u90E8\\u5206\\uFF1B\\u4EE5\\'||\\'\\u5206\\u9694', autosize: { minRows: 2, maxRows: 6 } })\n                        ),\n                        _react2.default.createElement(_input2.default, { ref: 'bookHref', value: book.href, onChange: this.bookHrefChange, placeholder: '\\u76F8\\u5173\\u94FE\\u63A5' }),\n                        _react2.default.createElement(_input2.default, { ref: 'bookName', value: book.author, onChange: this.bookNameChange, placeholder: '\\u4E66\\u540D' }),\n                        !book.id ? _react2.default.createElement(\n                            _button2.default,\n                            { onClick: function onClick() {\n                                    _this3.addBanner(\"BOOK\");\n                                } },\n                            '\\u6DFB\\u52A0'\n                        ) : _react2.default.createElement(\n                            _button2.default,\n                            { onClick: function onClick() {\n                                    _this3.updateBanner(book);\n                                } },\n                            '\\u4FDD\\u5B58'\n                        )\n                    )\n                )\n            );\n        }\n    }]);\n    return BannerSetting;\n}(_react.Component);\n\nBannerSetting.contextTypes = {\n    showMessage: _propTypes2.default.func\n};\nexports.default = BannerSetting;",null]}