{"remainingRequest":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js?{\"presets\":[]}!/Users/mael.liang/Workspace/node-koa-test/web/page/admin/PhotoManage/index.js","dependencies":[{"path":"/Users/mael.liang/Workspace/node-koa-test/web/page/admin/PhotoManage/index.js","mtime":1519640468983},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/mael.liang/Workspace/node-koa-test/node_modules/babel-loader/lib/index.js","mtime":1503096278000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _upload = require('antd/lib/upload');\n\nvar _upload2 = _interopRequireDefault(_upload);\n\nvar _pagination = require('antd/lib/pagination');\n\nvar _pagination2 = _interopRequireDefault(_pagination);\n\nvar _col = require('antd/lib/col');\n\nvar _col2 = _interopRequireDefault(_col);\n\nvar _card = require('antd/lib/card');\n\nvar _card2 = _interopRequireDefault(_card);\n\nvar _tooltip = require('antd/lib/tooltip');\n\nvar _tooltip2 = _interopRequireDefault(_tooltip);\n\nvar _icon = require('antd/lib/icon');\n\nvar _icon2 = _interopRequireDefault(_icon);\n\nvar _button = require('antd/lib/button');\n\nvar _button2 = _interopRequireDefault(_button);\n\nvar _modal = require('antd/lib/modal');\n\nvar _modal2 = _interopRequireDefault(_modal);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _input = require('antd/lib/input');\n\nvar _input2 = _interopRequireDefault(_input);\n\nvar _layout = require('antd/lib/layout');\n\nvar _layout2 = _interopRequireDefault(_layout);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _reactMasonryComponent = require('react-masonry-component');\n\nvar _reactMasonryComponent2 = _interopRequireDefault(_reactMasonryComponent);\n\nvar _config = require('../../../config/');\n\nrequire('./index.less');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Header = _layout2.default.Header,\n    Content = _layout2.default.Content,\n    Footer = _layout2.default.Footer;\nvar TextArea = _input2.default.TextArea;\n\nvar ArticleManege = function (_Component) {\n    (0, _inherits3.default)(ArticleManege, _Component);\n\n    function ArticleManege(props) {\n        (0, _classCallCheck3.default)(this, ArticleManege);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (ArticleManege.__proto__ || (0, _getPrototypeOf2.default)(ArticleManege)).call(this, props));\n\n        _this.showAddPhoto = function () {\n            _this.setState({\n                addPhotoStatus: true\n            });\n        };\n\n        _this.closeAddPhoto = function () {\n            _this.setState({\n                addPhotoStatus: false\n            });\n        };\n\n        _this.handleCancelPreview = function () {\n            return _this.setState({\n                previewVisible: false\n            });\n        };\n\n        _this.uploaderPreview = function (file) {\n            _this.setState({\n                previewImage: file.url || file.thumbUrl,\n                previewVisible: true\n            });\n        };\n\n        _this.uploadereChange = function (_ref) {\n            var file = _ref.file,\n                fileList = _ref.fileList,\n                event = _ref.event;\n\n            _this.setState({ fileList: fileList });\n        };\n\n        _this.descInputChange = function (e) {\n            return _this.setState({ desc: e.target.value });\n        };\n\n        _this.uploaderRemove = function () {};\n\n        _this.addToPhoto = function () {\n            var _this$state = _this.state,\n                fileList = _this$state.fileList,\n                desc = _this$state.desc;\n\n\n            var photoes = fileList.map(function (file) {\n                var response = file.response;\n\n                if (file.status == 'done') return {\n                    name: response.data.filename,\n                    key: response.data.key,\n                    width: response.data.w,\n                    height: response.data.h,\n                    desc: desc\n                };\n            });\n\n            if (!photoes.length) return;\n\n            _axios2.default.post('/api/add/photo', photoes).then(function (res) {\n                var resData = res.data;\n                if (resData.code == 200) {\n                    _this.getPhotoes();\n                    _this.setState({ fileList: [] });\n                }\n            });\n        };\n\n        _this.setToBanner = function (photoIndex) {\n            var photoes = _this.state.photoes;\n\n            var photo = photoes[photoIndex],\n                isBanner = photo.isBanner;\n\n            if (photo.id) _axios2.default.post('/api/update/photo/' + photo.id, { isBanner: !isBanner }).then(function (res) {\n                var resData = res.data;\n                if (resData.code == 200) {\n                    photoes[photoIndex].isBanner = !isBanner;\n                    _this.setState({ photoes: photoes });\n                } else {\n                    _this.context.showMessage(resData.message);\n                }\n            });\n        };\n\n        _this.changPhotoText = function (event, photo) {\n            event.target.blur();\n            _axios2.default.post('/api/update/photo/' + photo.id, { desc: event.target.value }).then(function (res) {\n                var resData = res.data;\n                if (resData.code == 200) {\n                    _this.context.showMessage(\"修改成功\");\n                } else {\n                    _this.context.showMessage(resData.message);\n                }\n            });\n        };\n\n        _this.deletePhoto = function (photo) {\n            _modal2.default.confirm({\n                title: '确定删除照片?',\n                content: '照片删除后不可恢复',\n                okText: '删除',\n                okType: 'danger',\n                cancelText: '取消',\n                onOk: function onOk() {\n                    return _this.doDelete(photo.id);\n                }\n            });\n        };\n\n        _this.changePage = function (page) {\n            _this.getPhotoes(page);\n        };\n\n        _this.state = {\n            previewVisible: false,\n            previewImage: '',\n            fileList: [],\n            file: null,\n            desc: '',\n            photoes: [],\n            one: [],\n            uploadRvent: null,\n            addPhotoStatus: false,\n            pageSize: 12,\n            page: 1,\n            allNum: 0,\n            allPage: 0\n        };\n        return _this;\n    }\n\n    (0, _createClass3.default)(ArticleManege, [{\n        key: 'componentWillMount',\n        value: function componentWillMount() {\n            this.getPhotoes(1);\n            this.getOne();\n        }\n    }, {\n        key: 'getPhotoes',\n        value: function getPhotoes(_page) {\n            var _this2 = this;\n\n            var _state = this.state,\n                pageSize = _state.pageSize,\n                page = _state.page;\n\n            _axios2.default.get('/api/get/photoes', {\n                params: {\n                    page: _page || page,\n                    size: pageSize\n                }\n            }).then(function (res) {\n                var resData = res.data;\n                var photoes = resData.photoes.map(function (img) {\n                    return {\n                        imgUrl: '' + _config.IMG_URL + img.key + '?' + _config.IMG_QUERY,\n                        key: img.key,\n                        text: img.desc,\n                        id: img.id,\n                        isBanner: img.isBanner || false\n                    };\n                });\n                _this2.setState({ photoes: photoes, page: _page, allPage: resData.allPage, allNum: resData.allNum });\n            });\n        }\n    }, {\n        key: 'getOne',\n        value: function getOne() {\n            var _this3 = this;\n\n            _axios2.default.get('/api/one').then(function (res) {\n                _this3.setState({\n                    one: res.data.data\n                });\n            });\n        }\n    }, {\n        key: 'doDelete',\n        value: function doDelete(id) {\n            var _this4 = this;\n\n            return _axios2.default.delete('/api/photo/' + id).then(function (res) {\n                _this4.context.showMessage(res.data.message);\n                if (res.data.code == 200) {\n                    _this4.getPhotoes();\n                }\n            }).catch(function (err) {\n                _this4.context.showMessage(err);\n            });\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _this5 = this;\n\n            var _state2 = this.state,\n                previewVisible = _state2.previewVisible,\n                previewImage = _state2.previewImage,\n                addPhotoStatus = _state2.addPhotoStatus,\n                fileList = _state2.fileList,\n                photoes = _state2.photoes,\n                one = _state2.one,\n                pageSize = _state2.pageSize,\n                page = _state2.page,\n                allNum = _state2.allNum,\n                allPage = _state2.allPage;\n\n            var data = photoes.length ? photoes : one;\n            return _react2.default.createElement(\n                _layout2.default,\n                { className: 'photo-manage-layout' },\n                _react2.default.createElement(\n                    Header,\n                    { className: 'photo-manage-header clearfix' },\n                    _react2.default.createElement(\n                        'h3',\n                        null,\n                        ' \\u56FE \\u96C6 '\n                    ),\n                    _react2.default.createElement(\n                        'div',\n                        { className: 'fr' },\n                        _react2.default.createElement(\n                            _button2.default,\n                            { icon: 'plus', onClick: this.showAddPhoto },\n                            '\\u6DFB\\u52A0\\u56FE\\u7247'\n                        )\n                    )\n                ),\n                _react2.default.createElement(\n                    Content,\n                    { className: 'photo-manage-content' },\n                    _react2.default.createElement(\n                        _reactMasonryComponent2.default,\n                        { className: 'photo-list' },\n                        data.length ? data.map(function (item, i) {\n                            return _react2.default.createElement(\n                                _col2.default,\n                                { span: 8, key: i },\n                                _react2.default.createElement(\n                                    _card2.default,\n                                    { bodyStyle: { padding: 0 } },\n                                    _react2.default.createElement(\n                                        'div',\n                                        { className: 'one-image' },\n                                        _react2.default.createElement('img', { src: item.imgUrl })\n                                    ),\n                                    _react2.default.createElement(\n                                        'div',\n                                        { className: 'one-card' },\n                                        _react2.default.createElement(\n                                            'div',\n                                            { className: 'text' },\n                                            _react2.default.createElement(_input2.default, { className: 'text-input', onPressEnter: function onPressEnter(e) {\n                                                    _this5.changPhotoText(e, item);\n                                                }, defaultValue: item.text, key: item.text })\n                                        ),\n                                        _react2.default.createElement(\n                                            'div',\n                                            { className: 'banner-setting', onClick: function onClick() {\n                                                    _this5.setToBanner(i);\n                                                } },\n                                            _react2.default.createElement(\n                                                _tooltip2.default,\n                                                { placement: 'top', title: item.isBanner ? '点击取消设置为Banner' : '点击设置为Banner' },\n                                                _react2.default.createElement(_icon2.default, { type: item.isBanner ? \"heart\" : \"heart-o\" })\n                                            )\n                                        )\n                                    ),\n                                    _react2.default.createElement(_icon2.default, { type: 'delete', className: 'photo-delete', onClick: function onClick(e) {\n                                            _this5.deletePhoto(item);\n                                        } })\n                                )\n                            );\n                        }) : null\n                    )\n                ),\n                allPage > 1 ? _react2.default.createElement(\n                    Footer,\n                    null,\n                    _react2.default.createElement(_pagination2.default, { className: 'tc', showQuickJumper: true, current: page, total: allNum, onChange: this.changePage, pageSize: pageSize })\n                ) : null,\n                _react2.default.createElement(\n                    _modal2.default,\n                    { visible: previewVisible, footer: null, onCancel: this.handleCancelPreview },\n                    _react2.default.createElement('img', { alt: 'example', style: { width: '100%' }, src: previewImage })\n                ),\n                _react2.default.createElement(\n                    _modal2.default,\n                    { visible: addPhotoStatus, footer: null, className: 'upload-modal', onCancel: this.closeAddPhoto },\n                    _react2.default.createElement(\n                        'div',\n                        { className: 'upload-modal-content' },\n                        _react2.default.createElement(\n                            _upload2.default,\n                            {\n                                className: 'uploader',\n                                accept: 'image/*',\n                                action: '/api/fileupload',\n                                listType: 'picture',\n                                fileList: fileList,\n                                data: { prefix: 'photo/' },\n                                onPreview: this.uploaderPreview,\n                                onRemove: this.uploaderRemove,\n                                onChange: this.uploadereChange },\n                            _react2.default.createElement(\n                                'div',\n                                { className: 'upload-plus' },\n                                _react2.default.createElement(_icon2.default, { type: 'picture' }),\n                                _react2.default.createElement(\n                                    'span',\n                                    { className: 'ant-upload-text' },\n                                    ' \\u9009\\u62E9\\u6587\\u4EF6\\u4E0A\\u4F20'\n                                )\n                            )\n                        ),\n                        _react2.default.createElement(TextArea, { placeholder: '\\u6DFB\\u52A0\\u6587\\u4EF6\\u63CF\\u8FF0', autosize: { minRows: 2, maxRows: 6 }, onChange: this.descInputChange }),\n                        _react2.default.createElement(\n                            _button2.default,\n                            { size: 'large', type: 'primary', icon: 'save', onClick: this.addToPhoto },\n                            '\\u4FDD\\u5B58'\n                        )\n                    )\n                )\n            );\n        }\n    }]);\n    return ArticleManege;\n}(_react.Component);\n\nArticleManege.contextTypes = {\n    showMessage: _propTypes2.default.func\n};\nexports.default = ArticleManege;",null]}